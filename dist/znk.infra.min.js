!function(a){"use strict";a.module("znk.infra",["znk.infra.pngSequence","znk.infra.enum","znk.infra.svgIcon","znk.infra.general","znk.infra.scroll","znk.infra.content"])}(angular),function(a){"use strict";a.module("znk.infra.content",[])}(angular),function(a){"use strict";a.module("znk.infra.enum",[])}(angular),function(a){"use strict";a.module("znk.infra.general",["znk.infra.enum"])}(angular),function(a){"use strict";a.module("znk.infra.pngSequence",[])}(angular),function(a){"use strict";a.module("znk.infra.scroll",[])}(angular),function(a){"use strict";a.module("znk.infra.svgIcon",[])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise",["znk.infra.enum","znk.infra.svgIcon","angular-carousel"]).config(["SvgIconSrvProvider",function(a){var b={chevron:"components/znkExercise/svg/chevron-icon.svg"};a.registerSvgSources(b)}])}(angular),function(a){function b(){var b;this.setContent=function(a){b=a},this.$get=["$q","$injector",function(c,d){function e(){var a;return function(){return{get:function(){return a?c.when(a):f().then(function(b){return a=b,a.updatePublication(function(b){b.key()!==a.key&&(a.latestRevisions=b.val(),a.key=b.key())}),b})},set:function(b,d){return a.revisionManifest[b]=d,c.when({rev:d.rev,status:"update"})}}}}function f(){return g||(g=d.invoke(b)),g}var g,h=e(),i={};return i.getRev=function(b,d){if(!d||!d.revisionManifest||!d.latestRevisions)return c.when({error:"No Data Found! ",data:d});var e,f=d.revisionManifest[b],g=d.latestRevisions[b];return a.isUndefined(g)?c.when({error:"Not Found",data:d}):(e=f?f.rev<g.rev?{rev:f.rev,status:"old"}:f.rev===g.rev?{rev:g.rev,status:"same"}:{error:"failed to get revision!",data:d}:{rev:g.rev,status:"new"},c.when(e))},i.setRev=function(a,b){return h().set(a,{rev:b})},i.getContent=function(a){if(!a||!a.exerciseId||!a.exerciseType)return c.when({error:"Error: getContent require exerciseId and exerciseType!"});var b=a.exerciseType+a.exerciseId;return h().get().then(function(a){return i.getRev(b,a).then(function(d){if(d.error)return c.when(d);if(!a.contentRoot)return c.when({error:"Error: getContent require contentRoot to be defined in config phase!"});if(!a.userRoot)return c.when({error:"Error: getContent require userRoot to be defined in config phase!"});var e=a.contentRoot+b+"-rev-"+d.rev,f=a.create(e);return"new"===d.status&&i.setRev(b,d.rev).then(function(){var c=a.userRoot+"/revisionManifest/"+b,e=a.create(c);e.set({rev:d.rev})}),f.get()})})},i}]}a.module("znk.infra.content").provider("ContentSrv",b)}(angular),function(a){"use strict";var b={NEW:0,ACTIVE:1,COMPLETED:2,COMING_SOON:3};a.module("znk.infra.enum").constant("exerciseStatusConst",b),a.module("znk.infra.enum").factory("ExerciseStatusEnum",["EnumSrv",function(a){return new a.BaseEnum([["NEW",b.NEW,"new"],["ACTIVE",b.ACTIVE,"active"],["COMPLETED",b.COMPLETED,"completed"],["COMING_SOON",b.COMING_SOON,"coming soon"]])}])}(angular),function(a){"use strict";var b={MATH:0,READING:1,WRITING:2,LISTENING:3,SPEAKING:4,ENGLISH:5,SCIENCE:6};a.module("znk.infra.enum").constant("SubjectEnumConst",b),a.module("znk.infra.enum").factory("SubjectEnum",["EnumSrv",function(a){var c=new a.BaseEnum([["MATH",b.MATH,"math"],["READING",b.READING,"reading"],["WRITING",b.WRITING,"writing"],["LISTENING",b.LISTENING,"listening"],["SPEAKING",b.SPEAKING,"speaking"],["ENGLISH",b.ENGLISH,"english"],["SCIENCE",b.SCIENCE,"science"]]);return c}])}(angular),function(a){a.module("znk.infra.enum").factory("EnumSrv",[function(){function b(a){var b=0,c=1,d=2,e=this;a.forEach(function(a){e[a[b]]={"enum":a[c],val:a[d]}})}var c={};return c.BaseEnum=b,b.prototype.getEnumMap=function(){var a=this,b={},c=Object.keys(a);for(var d in c){var e=c[d],f=a[e];b[f["enum"]]=f.val}return b},b.prototype.getEnumArr=function(){var b=this,c=[];for(var d in b){var e=b[d];a.isObject(e)&&c.push(e)}return c},c.flashcardStatus=new b([["keep",0,"Keep"],["remove",1,"Remove"]]),c}])}(angular),function(a){"use strict";a.module("znk.infra.general").directive("subjectIdToClassDrv",["SubjectEnum",function(b){return{priority:1e3,link:{pre:function(c,d,e){var f=c.$watch(e.subjectIdToClassDrv,function(c){if(!a.isUndefined(c)){f();var g;for(var h in b)if(b[h]["enum"]===c){g=b[h].val,e.classSuffix&&(g+=e.classSuffix);break}d.addClass(g)}})}}}}])}(angular),function(a){"use strict";a.module("znk.infra.pngSequence").directive("pngSequence",["$timeout","ExpansionSrcSrv","$window",function(b,c,d){return{restrict:"E",scope:{onEnded:"&",loop:"&",speed:"&",autoPlay:"&",actions:"="},link:function(e,f,g){function h(){var a,b=+g.startIndex,d=+g.endIndex;n=d-b;for(var e=b;d>e;e++){a=100>e||10>e?10>e?"00"+e:"0"+e:e;var h="<div  style=\"background-image: url('"+c.getExpansionSrc(g.imgData+a+".png")+"'); background-size: cover; will-change: opacity; opacity:0; position: absolute; top:0; left:0;\"></div>";f.append(h)}}function i(){f.empty()}function j(){this.index=0,this.imagesDomElem=f[0].children,this.lastTimestamp=!1}function k(c){this.index!==n-1||e.loop()?this.lastTimestamp&&c-this.lastTimestamp<40?o=d.requestAnimationFrame(k.bind(this)):(this.imagesDomElem[this.index].style.opacity=0,this.index=(this.index+1)%n,this.imagesDomElem[this.index].style.opacity=1,this.lastTimestamp=c,o=d.requestAnimationFrame(k.bind(this))):b(function(){var b=f.children();a.element(b[b.length-1]).css("display","none"),e.onEnded()})}function l(){if(i(),g.imgData&&a.isDefined(g.startIndex)&&g.endIndex&&(h(),e.autoPlay())){var b=new j;o=d.requestAnimationFrame(k.bind(b))}}function m(){return g.imgData+"_"+g.startIndex+"_"+g.endIndex+"_"+g.rotate}var n,o;e.$watch(m,l),e.actions=e.actions||{},e.actions.play=function(){b(function(){var a=new j;o=d.requestAnimationFrame(k.bind(a))},0,!1)},e.actions.reset=i,e.$on("$destroy",function(){d.cancelAnimationFrame(o)})}}}])}(angular),function(a){"use strict";a.module("znk.infra.scroll").directive("znkScroll",["$log","$window","$timeout","$interpolate",function(b,c,d,e){function f(c,d,e,f,h){var i=a.isArray(c)?c[0]:c,j=d;if(e){var k,l=i.style.transform,m=l.match(/translateX\((.*)px\)/);!a.isArray(m)||m.length<2?(b.debug("failed to math transform value"),k=0):k=+m[1],j+=k}f=a.isUndefined(f)?-(1/0):f,h=a.isUndefined(h)?1/0:h,j=Math.max(j,f),j=Math.min(j,h);var n="translateX("+j+"px)";g(i,"transform",n)}function g(b,c,d){var e=a.isArray(b)?b[0]:b;null===d?e.style[c]="":e.style[c]=d}function h(b){var d=a.isArray(b)?b[0]:b,e=c.getComputedStyle(d),f=+e.marginRight.replace("px",""),g=+e.marginLeft.replace("px","");return d.offsetWidth+f+g}return{restrict:"E",compile:function(c){function i(a){b.debug("mouse move",a.pageX);var c=a.pageX-n.x;n.x=a.pageX,n.y=a.pageY,l(c,o,p)}function j(a){b.debug("mouse up",a.pageX),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",j),o=null,p=null,n=null}function k(a){b.debug("mouse down",a.pageX),o=q.offsetWidth,p=h(q.children[0]),n={x:a.pageX,y:a.pageY},document.addEventListener("mousemove",i),document.addEventListener("mouseup",j)}function l(a,b,c){var d=Math.min(b-c,0),e=0;r.style.transform||f(r,0,!1,!1,d,e),f(r,a,!0,d,e)}function m(a){var b=q.offsetWidth,c=h(r),d=Math.min(b-c,0),e=0;f(r,a,!1,d,e)}var n,o,p,q=c[0],r=q.children[0];return q.addEventListener("mousedown",k),{pre:function(c,j,n){function o(a){b.debug("mouse wheel event",a),l(-a.deltaY,t,u)}function p(){b.debug("mouse enter"),t=q.offsetWidth,u=h(q.children[0]),q.addEventListener("mousewheel",o)}function r(){b.debug("mouse leave"),q.removeEventListener("mousewheel",o)}var s=q.children[0];f(s,0);var t,u,v="false"!==e(n.scrollOnMouseWheel||"")(c);if(v&&(q.addEventListener("mouseenter",p),q.addEventListener("mouseleave",r)),n.actions){a.isUndefined(c.$eval(n.actions))&&c.$eval(n.actions+"={}");var w=c.$eval(n.actions);w.animate=function(a,b,c){if(b&&c){var e="transform "+b+"ms "+c;g(s,"transition",e)}m(a),d(function(){g(s,"transition",null)},b,!1)}}c.$on("$destroy",function(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),q.removeEventListener("mousedown",k),q.removeEventListener("mouseenter",p),q.removeEventListener("mouseleave",r),q.removeEventListener("mousewheel",o)})}}}}}])}(angular),function(a){"use strict";a.module("znk.infra.svgIcon").directive("svgIcon",["$log","SvgIconSrv",function(a,b){return{scope:{name:"@"},link:{pre:function(c,d){var e=c.name;return e?(d.addClass(e),void b.getSvgByName(e).then(function(a){d.append(a)})):void a.error("svgIcon directive: name attribute was not set")}}}}])}(angular),function(a){"use strict";a.module("znk.infra.svgIcon").provider("SvgIconSrv",[function(){var b={};this.setConfig=function(c){a.extend(b,c)};var c={};this.registerSvgSources=function(b){var d=Object.keys(c);return d.forEach(function(a){b[a]&&console.log("SvgIconSrv: svg icon was already defined before ",a)}),a.extend(c,b),!0};var d={};this.$get=["$templateCache","$q","$http",function(a,b,e){var f={};return f.getSvgByName=function(f){var g=c[f];if(d[g])return d[g];var h=a.get(g);if(h)return b.when(h);var i=e.get(g).then(function(b){return a.put(g,b.data),delete d[g],b.data});return d[g]=i,i},f}]}])}(angular),function(a){a.module("znk.infra.znkExercise").directive("arrayToStringFmtr",[function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){return a&&a.length?a.join(""):void 0}function f(a){return a&&a.length?a.match(/.{1}/g):[]}d.$parsers.push(e),d.$formatters.push(f)}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("freeTextAnswerGrid",function(){return{templateUrl:"scripts/exercise/templates/freeTextAnswerGridDrv.html",restrict:"E",require:"ngModel",scope:{cellsNumGetter:"&cellsNum"},link:function(b,c,d,e){function f(){e.$setViewValue(a.copy(b.d.cells))}b.buttonArray=[1,2,3,4,5,6,7,8,9];var g=b.cellsNumGetter()||3;b.d={viewCells:new Array(g)},b.onClickNum=function(a){d.disabled||b.d.cells.length>=g||(b.d.cells.push(a),f())},b.onClickErase=function(){!d.disabled&&b.d.cells.length&&(b.d.cells.pop(),f())},e.$render=function(){b.d.cells=a.isDefined(e.$viewValue)?e.$viewValue:[]}}}})}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("selectAnswerDrv",["$timeout","ZnkExerciseDrvSrv","MediaSrv",function(b,c,d){return{templateUrl:"scripts/exercise/templates/selectAnswerDrv.html",require:["^simpleQuestion","^ngModel"],scope:{},link:function(e,f,g,h){function i(b){for(var c=k.$viewValue,e=j.question.correctAnswerId,g=a.element(f[0].querySelectorAll(".answer")),h=0;h<g.length;h++){var i=a.element(g[h]);if(i&&i.scope&&i.scope()){var p,q,r=i.scope().answer;j.getViewMode()===m||j.getViewMode()===o?(q="answered",p=c===r.id?"answered":"neutral"):a.isUndefined(c)?j.getViewMode()===n&&(p=e===r.id?"answered-incorrect":"neutral"):p=c===r.id?e===r.id?"correct":"wrong":r.id===e?"answered-incorrect":"neutral",i.removeClass(q),i.addClass(p),b===l&&("correct"===p&&d.playCorrectAnswerSound(),"wrong"===p&&d.playWrongAnswerSound())}}}var j=h[0],k=h[1],l=c.viewModeEnum.answerWithResult["enum"],m=c.viewModeEnum.answerOnly["enum"],n=c.viewModeEnum.review["enum"],o=c.viewModeEnum.mustAnswer["enum"];e.d={},e.d.answers=j.question.answers,e.d.showSolution=j.showSolution,e.d.tap=function(a){var b=j.getViewMode();!isNaN(parseInt(k.$viewValue))&&b===l||b===n||(k.$setViewValue(a.id),i(b))},k.$render=function(){b(function(){i()})},k.$render(),e.$on("exercise:viewModeChanged",function(){k.$render()})}}}])}(angular),function(a){"use strict";var b={BOOKMARK:"znk exercise:bookmark",QUESTION_ANSWERED:"znk exercise:question answered"};a.module("znk.infra.znkExercise").constant("ZnkExerciseEvents",b)}(angular),function(a){"use strict";var b={0:"<div select-answer-drv></div>",1:"<div free-text-answer-drv></div>"};a.module("znk.infra.znkExercise").directive("answersBuilderDrv",["$compile",function(a){return{require:"^simpleQuestion",link:function(c,d,e,f){var g=f.question.answerTypeId,h=b[g];d.html(h),a(d.contents())(c)}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("questionBuilder",["$compile","QuestionTypesSrv","$timeout",function(a,b,c){return{restrict:"E",require:["questionBuilder","^znkExercise"],scope:{questionGetter:"&question"},controller:["$scope",function(a){var b=this;b.question=a.questionGetter()}],link:{pre:function(a,b,c,d){var e=d[0],f=d[1];e.getViewMode=f.getViewMode,e.questionChangeResolver=f.questionChangeResolver.bind(f)},post:function(d,e,f,g){var h=g[0],i=g[1],j=h.question.__type,k=b.getQuestionHtmlTemplate(j);e.append(k);var l=d.$new(!0);a(e.contents())(l);var m;c(function(){m=c(function(){i.notifyQuestionReady(h.question.__questionStatus.index)})},0,!1),d.$on("$destroy",function(){c.cancel(m)})}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("znkExerciseBtnSection",["ZnkExerciseSrv","PlatformEnum","$log","ZnkExerciseEvents",function(a,b,c,d){return{restrict:"E",scope:{prevQuestion:"&?",nextQuestion:"&?",questionsGetter:"&questions"},require:["znkExerciseBtnSection","^znkExercise"],controllerAs:"vm",controller:["$scope",function(a){this.prevQuestion=function(){a.prevQuestion()},this.nextQuestion=function(){a.nextQuestion()}}],templateUrl:function(){var d="components/znkExercise/core/template/",e=a.getPlatform();switch(e){case b.DESKTOP["enum"]:d+="btnSectionDesktopTemplate.html";break;case b.MOBILE["enum"]:d+="btnSectionMobileTemplate.html"}return d||c.error("znkExerciseBtnSectionDrv directive: template was not defined for platform"),d},link:function(a,b,c,e){var f=e[1],g=f.getQuestions();a.$parent.$watch(c.activeSlide,function(b){b&&b===g.length-1||f.isLastUnansweredQuestion()?a.vm.showDoneButton=!0:a.vm.showDoneButton=!1}),a.$on(d.QUESTION_ANSWERED,function(){f.isLastUnansweredQuestion()&&(a.vm.showDoneButton=!0)})}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").provider("QuestionTypesSrv",function(){var a={};this.setQuestionTypesHtmlTemplate=function(b){a=b},this.$get=["$log",function(b){var c={};return c.getQuestionHtmlTemplate=function(c){return a[c]||b.error("QuestionTypesSrv: Template was not registered for the following question type:",c),a[c]},c}]})}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("ZnkExerciseSrv",["EnumSrv","$window","PlatformEnum",function(a,b,c){var d={},e=b.ionic?c.MOBILE["enum"]:c.DESKTOP["enum"];return d.getPlatform=function(){return e},d.openExerciseToolBoxModal=function(){},d.toolBoxTools={BLACKBOARD:"blackboard",MARKER:"mar",CALCULATOR:"cal",BOOKMARK:"bookmark",SHOW_PAGER:"show pager"},d.slideDirections={NONE:"none",ALL:"all",RIGHT:"right",LEFT:"left"},d}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("znkExercise",["ZnkExerciseSrv","$location","$window","$q","ZnkExerciseEvents","PlatformEnum","$log","ZnkExerciseViewModeEnum",function(b,c,d,e,f,g,h,i){return{templateUrl:"components/znkExercise/core/template/znkExerciseDrv.html",restrict:"E",transclude:!0,controllerAs:"vm",require:["znkExercise","ngModel"],scope:{questionsGetter:"&questions",settings:"=?",actions:"=?"},controller:"ZnkExerciseDrvCtrl",compile:function(c){var j=b.getPlatform();j||h.$error("znkExercise directive: undefined platform received.");var k=g.getEnumMap();return c.addClass(k[j]),{pre:function(c,g,h,j){function k(){return p[c.d.currentSlide]}function l(){s.$setViewValue(a.copy(c.d.questionsWithAnswers))}function m(a){p=a,c.d.questionsWithAnswers=p}function n(b){if(b=a.isDefined(b)?b:c.d.currentSlide,c.settings.viewMode!==i.REVIEW["enum"]){if(!n.lastTimeStamp)return void(n.lastTimeStamp=Date.now());var d=Date.now(),e=d-n.lastTimeStamp;n.lastTimeStamp=d;var f=c.d.questionsWithAnswers[b];f.__questionStatus.timeSpent=(f.__questionStatus.timeSpent||0)+e}}var o={onNext:function(){c.d.currentSlide++},onDone:a.noop,onQuestionAnswered:a.noop,viewMode:i.ANSWER_WITH_RESULT["enum"],onSlideChange:a.noop};c.settings=a.extend(o,c.settings);var p,q,r=j[0],s=j[1],t={},u=d.innerWidth<=567;c.d={currentSlide:c.settings.initSlideIndex||0,answeredCount:0,slideDirections:b.slideDirections},c.actions=c.actions||{},c.actions.setSlideIndex=function(a){c.d.currentSlide=a},c.actions.getCurrentIndex=function(){return c.d.currentSlide},c.actions.finishExercise=function(){n(),l()};var v={toolsToHide:c.settings.toolsToHide,wrapperCls:c.settings.toolBoxWrapperClass||""};v.events={onToolOpened:function(a){var d=k();switch(a.tool){case b.toolBoxTools.BLACKBOARD:v.actions.setToolValue(b.toolBoxTools.BLACKBOARD,d.__questionStatus.blackboardData||{}),u&&(c.d.hidePager=!0)}},onToolClosed:function(a){var d=k();switch(a.tool){case b.toolBoxTools.BLACKBOARD:d.__questionStatus.blackboardData=a.value,u&&(c.d.hidePager=!1)}l()},onToolValueChanged:function(a){switch(a.tool){case b.toolBoxTools.BOOKMARK:c.d.bookmarkCurrentQuestion()}l()}};var w=b.openExerciseToolBoxModal(v);s.$render=function(){m(s.$viewValue)},t.formatter=function(b){b||(b=[]);var d={};b.forEach(function(b){b&&a.isDefined(b.questionId)&&(d[b.questionId]=b)});var e=c.questionsGetter()||[],f=e.map(function(b,c){var e=a.copy(b),f=d[e.id]||{};e.__questionStatus={index:c};for(var g in f)e.__questionStatus[g]=f[g];return e});return f},s.$formatters.push(t.formatter),t.parser=function(b){return c.d.answeredCount=0,b.forEach(function(b,d){if(!a.isUndefined(b.__questionStatus)){var e={questionId:b.id},f=["blackboardData","timeSpent","bookmark","userAnswer","isAnsweredCorrectly","audioEnded"];f.forEach(function(c){var d=b.__questionStatus[c];a.isDefined(d)&&(e[c]=d)}),a.isDefined(e.userAnswer)&&c.d.answeredCount++,s.$modelValue[d]=e}}),s.$modelValue},s.$parsers.push(t.parser),c.d.questionAnswered=function(){c.$broadcast(f.QUESTION_ANSWERED,k()),c.settings.viewMode!==i.REVIEW["enum"]&&l(),c.settings.onQuestionAnswered(c.d.currentSlide),q=!0,c.settings.slideDirection=c.settings.slideDirectionChange},c.d.bookmarkCurrentQuestion=function(){var a=k();a.__questionStatus.bookmark=!a.__questionStatus.bookmark,c.$broadcast(f.BOOKMARK,a),l()},c.d.next=function(){var a=c.d.currentSlide,b=p[p.length-1];r.questionChangeResolver().then(function(){b!==c.d.questionsWithAnswers[a]&&c.d.answeredCount!==c.d.questionsWithAnswers.length?c.settings.onNext():(n(),l(),c.settings.onDone()),q=!1})},c.$watch("d.currentSlide",function(a,d){if(n(d),v.actions&&v.actions.setToolValue){var e=k();v.actions.setToolValue(b.toolBoxTools.BOOKMARK,!!e.__questionStatus.bookmark)}r.questionChangeResolver(null),q=!1,c.settings.onSlideChange()}),c.$watch("settings.slideDirection",function(a){a===b.slideDirections.NONE&&r.questionChangeResolver(function(){var a=e.defer();return r.isCurrentQuestionAnswered()&&a.resolve(),a.promise})}),c.$on("$destroy",function(){w&&w.close()})}}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").controller("ZnkExerciseDrvCtrl",["$scope","$q",function(b,c){function d(c){var d=b.d.questionsWithAnswers?b.d.questionsWithAnswers[c]:{};return d&&d.__questionStatus&&a.isDefined(d.__questionStatus.userAnswer)}var e=this;e.getViewMode=function(){return b.settings.viewMode},e.getSlideDirection=function(){return b.settings.slideDirection},e.questionChangeResolver=function(){var b;return function(d){return a.isDefined(d)&&(b=d),c.when(b)}}(),e.getCurrentIndex=function(){return b.d.currentSlide},e.setCurrentIndex=function(d){return a.isDefined(d)?e.questionChangeResolver().then(function(){return b.d.currentSlide=d,b.d.currentSlide}):c.when(b.d.currentSlide)},e.setCurrentIndexByOffset=function(a){var c=this.getCurrentIndex(),d=c+a;d=Math.max(0,d);var e=b.questionsGetter()||[];return d=Math.min(d,e.length-1),this.setCurrentIndex(d)},e.notifyQuestionReady=function(){e.__exerciseReady||(e.__exerciseReady=!0,b.settings.onExerciseReady&&b.settings.onExerciseReady())},e.isCurrentQuestionAnswered=function(){return d(b.d.currentSlide)},e.isLastUnansweredQuestion=function(){for(var a=(b.d.questionsWithAnswers||[]).length,c=0,e=0;a>e;e++)if(!d(e)&&(c++,2===c))return!1;return 1===c},e.getQuestions=function(){return b.d.questionsWithAnswers}}])}(angular),function(){angular.module("znk.infra.znkExercise").directive("blackboardDrv",["GoBackHardwareSrv",function(a){return{restric:"EA",scope:{drawingData:"=",actions:"&",close:"&"},replace:!0,templateUrl:"scripts/exercise/templates/blackboardDrv.html",link:function(b,c){function d(){b.close()}function e(){b.d.activeDrawMode=o.pen}function f(){b.d.activeDrawMode=o.eraser}function g(){s.clearRect(0,0,r.width,r.height),b.drawingData.dataUrl=null}function h(a){return a.toDataURL()}function i(a,b){var c=new Image;c.onload=function(){b.width=c.width,b.height=c.height,b.getContext("2d").drawImage(c,0,0)},c.src=a}function j(a){a.preventDefault(),a.stopPropagation(),p=a.targetTouches[0].pageX,q=a.targetTouches[0].pageY,m(p+1,q+1)}function k(a){a.preventDefault(),a.stopPropagation();var b=a.targetTouches[0].pageX,c=a.targetTouches[0].pageY;m(b,c),p=b,q=c}function l(a){a.preventDefault(),a.stopPropagation(),b.drawingData=b.drawingData||{},b.drawingData.dataUrl=h(r)}function m(a,c){s.beginPath(),b.d.activeDrawMode===o.pen?(s.globalCompositeOperation="source-over",s.strokeStyle="#FFFFFF",s.lineWidth=4,s.moveTo(p,q),s.lineTo(a,c),s.stroke()):b.d.activeDrawMode===o.eraser&&(s.globalCompositeOperation="destination-out",s.arc(p,q,16,0,2*Math.PI,!1),s.fill())}a.registerHandler(d,void 0,!0);var n=b.actions()||{};angular.extend(n,{activatePen:e,activateEraser:f,clear:g});var o={pen:1,eraser:2};b.d={drawModes:o,activeDrawMode:o.pen};var p,q,r=c.find("canvas")[0];r.width=c[0].offsetWidth,r.height=c[0].offsetHeight;var s=r.getContext("2d");b.drawingData.dataUrl&&i(b.drawingData.dataUrl,r),r.addEventListener("touchstart",j),r.addEventListener("touchmove",k),r.addEventListener("touchend",l),b.$on("$destroy",function(){r.removeEventListener("touchstart",j),r.removeEventListener("touchmove",k),r.removeEventListener("touchend",l)})}}}])}(),function(a){a.module("znk.infra.znkExercise").directive("calculator",["GoBackHardwareSrv",function(a){var b=math.cos,c=math.sin,d=math.tan;return{scope:{calcTop:"=",close:"&"},link:function(e){function f(){e.close()}a.registerHandler(f,void 0,!0),math.cos=function(a){return b(math.unit(a,e.trigunits))},math.sin=function(a){return c(math.unit(a,e.trigunits))},math.tan=function(a){return d(math.unit(a,e.trigunits))},e.onClickAns=function(){"ERR"!==e.result&&(e.expression=e.result)},e.onClickNum=function(a){e.expression+=String(a)},e.onClickAdd=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" + "},e.onClickSubtract=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" - "},e.onClickMultiply=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" * "},e.onClickDivide=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" / "},e.onClickClear=function(){e.expression="",e.result=0},e.onClickDot=function(){e.expression+="."},e.onClickPi=function(){e.expression+=" pi "},e.onClickE=function(){e.expression+=" e "},e.onClickRad=function(){e.trigunits="rad"},e.onClickDeg=function(){e.trigunits="deg"},e.onClickSin=function(){e.expression+=" sin(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickCos=function(){e.expression+=" cos(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickTan=function(){e.expression+=" tan(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickSqr=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" ^2 "},e.onClickPowThree=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" ^3 "},e.onClickPow=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" ^ "},e.onClickSqrt=function(){e.expression+=" sqrt(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickInv=function(){e.expression+=" inv(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickAbs=function(){e.expression+=" abs(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickFact=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+="! "},e.onClickLog=function(){e.expression+=" log(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickLn=function(){e.expression+=" ln(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickOpenParen=function(){e.expression+="(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickCloseParen=function(){e.expression+=")"},e.onClickUndo=function(){e.expression=e.expression.trimRight(),e.expression=e.expression.substring(0,e.expression.length-1)},e.onClickEqual=function(){var a=e.expression.replace("log","log10").replace("ln","log");try{e.result=math.round(math.eval(a),5)}catch(b){try{a+=")",e.result=math.round(math.eval(a),5)}catch(b){e.result="ERR"}}e.expression=""},e.onClickMPlus=function(){e.mem+=e.result},e.onClickMc=function(){e.mem=0},e.onClickMR=function(){e.expression+=e.mem},e.hasMemory=function(){return e.mem>0};var g=function(){e.result=0,e.expression="",e.mem=0,e.trigunits="rad"};g()},templateUrl:"scripts/exercise/templates/calculator.html"}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").controller("ZnkExerciseToolBoxModalCtrl",["$scope","ZnkExerciseDrvSrv","Settings",function(b,c,d){function e(a,b){var c={tool:a,value:b};d.events.onToolValueChanged&&d.events.onToolValueChanged(c)}d.actions=d.actions||{},d.events=d.events||{},d.events.onToolOpened=d.events.onToolOpened||a.noop,d.events.onToolOpened=d.events.onToolOpened||a.noop,b.d={blackboardTool:{actions:{},value:{}},bookmarkTool:{},showPagerTool:{},tools:c.toolBoxTools,toolsStatus:{},toolsToHide:d.toolsToHide},d.actions.setToolValue=function(a,c){switch(a){case b.d.tools.BOOKMARK:b.d.bookmarkTool.value=c;break;case b.d.tools.BLACKBOARD:b.d.blackboardTool.value=c}},b.d.openTool=function(a){var c={tool:a};d.events.onToolOpened(c),b.d.toolsStatus[a]=!0},b.d.closeTool=function(a){var c={tool:a};switch(a){case b.d.tools.BLACKBOARD:c.value=b.d.blackboardTool.value;break;case b.d.tools.BOOKMARK:c.value=b.d.bookmarkTool.value}d.events.onToolClosed(c),b.d.toolsStatus[a]=!1},b.d.reverseBookmarkValue=function(){b.d.bookmarkTool.value=!b.d.bookmarkTool.value,e(b.d.tools.BOOKMARK,b.d.bookmarkTool.value)},b.d.activateBlackboardPencil=function(){b.d[b.d.tools.BLACKBOARD]||b.d.openTool(b.d.tools.BLACKBOARD),b.d.blackboardTool.pencilActivated=!0,b.d.blackboardTool.actions.activatePen&&b.d.blackboardTool.actions.activatePen()},b.d.activateBlackboardEraser=function(){b.d.blackboardTool.pencilActivated=!1,b.d.blackboardTool.actions.activateEraser&&b.d.blackboardTool.actions.activateEraser()},b.d.reverseShowPagerValue=function(){b.d.showPagerTool.value=!b.d.showPagerTool.value,e(b.d.tools.SHOW_PAGER,b.d.showPagerTool.value)},b.d.onCalcClick=function(){b.d.toolsStatus.hasOwnProperty(b.d.tools.CALCULATOR)?b.d.closeTool(b.d.tools.CALCULATOR):b.d.openTool(b.d.tools.CALCULATOR)}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("templateByPlatform",["ZnkExerciseSrv","PlatformEnum","$log",function(a,b,c){return{templateUrl:function(d,e){var f,g=e.prefix||"",h=a.getPlatform();switch(h){case b.DESKTOP["enum"]:f=e.desktopTemp;break;case b.MOBILE["enum"]:f=e.mobileTemp}return f||c.error("templateByPlatform directive: template was not defined for platform"),g+"/"+f},restrict:"E"}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("PlatformEnum",["EnumSrv",function(a){return new a.BaseEnum([["MOBILE",1,"mobile"],["DESKTOP",2,"desktop"]])}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("ZnkExerciseViewModeEnum",["EnumSrv",function(a){return new a.BaseEnum([["ANSWER_WITH_RESULT",1,"answer with result"],["ONLY_ANSWER",2,"answer only"],["REVIEW",3,"review"],["MUST_ANSWER",4,"must answer"]])}])}(angular),angular.module("znk.infra").run(["$templateCache",function(a){a.put("components/znkExercise/core/template/btnSectionDesktopTemplate.html",'<div class="btn-container left-container">\n    <button ng-click="vm.prevQuestion()">\n        <svg-icon name="chevron"></svg-icon>\n    </button>\n</div>\n<div class="btn-container right-container">\n    <button ng-click="vm.nextQuestion()">\n        <svg-icon name="chevron"></svg-icon>\n    </button>\n</div>\n<button class="done-btn ng-hide" ng-show="vm.showDoneButton">DONE</button>'),a.put("components/znkExercise/core/template/btnSectionMobileTemplate.html",'<div ng-class="{ \'next-disabled\' : settings.slideDirection === d.slideDirections.NONE ||  settings.slideDirection === d.slideDirections.RIGHT }">\n    <div class="bookmark-icon-container only-tablet"\n         ng-class="d.questionsWithAnswers[d.currentSlide].__questionStatus.bookmark ? \'bookmark-active-icon\' : \'bookmark-icon\'"\n         ng-click="d.bookmarkCurrentQuestion()"\n         ng-hide="settings.viewMode === d.reviewModeId"\n         analytics-on="click"\n         analytics-event="click-bookmark-question"\n         analytics-category="exercise"></div>\n    <ng-switch\n            on="d.currentSlide !== d.questionsWithAnswers.length - 1 && d.answeredCount !== d.questionsWithAnswers.length"\n            ng-hide="settings.viewMode === d.reviewModeId"\n            class="ng-hide"\n            ng-click="d.next()">\n        <button ng-switch-when="true"\n                class="btn next">\n            <div class="only-tablet"\n                 analytics-on="click"\n                 analytics-event="click-next"\n                 analytics-category="exercise">\n                <span>NEXT</span>\n                <i class="question-arrow-right-icon"></i>\n            </div>\n        </button>\n        <button ng-switch-when="false"\n                class="btn finish">\n            <div analytics-on="click"\n                 analytics-event="click-finish"\n                 analytics-category="exercise">DONE\n            </div>\n        </button>\n    </ng-switch>\n    <button class="btn sum ng-hide"\n            ng-click="settings.onSummary()"\n            ng-show="settings.viewMode === d.reviewModeId"\n            analytics-on="click"\n            analytics-event="click-summary"\n            analytics-category="exercise">SUMMARY\n    </button>\n</div>'),a.put("components/znkExercise/core/template/questionSwiperDesktopTemplate.html",'<ul class="znk-carousel"\n    rn-carousel\n    rn-carousel-index="d.currentSlide">\n    <li class="slide"\n        ng-repeat="question in d.questionsWithAnswers">\n        <question-builder slide-repeat-drv="question in d.questionsWithAnswers"\n                          active-slide="d.currentSlide"\n                          question="question"\n                          ng-model="question.__questionStatus.userAnswer"\n                          ng-change="d.questionAnswered(question)">\n        </question-builder>\n    </li>\n</ul>'),a.put("components/znkExercise/core/template/questionSwiperMobileTemplate.html",'<ion-slide-box znk-slide="settings.slideDirection" class="znk-carousel"\n               show-pager="false"\n               active-slide="d.currentSlide">\n    <question-builder slide-repeat-drv="question in d.questionsWithAnswers"\n                      active-slide="d.currentSlide"\n                      question="question"\n                      ng-model="question.__questionStatus.userAnswer"\n                      ng-change="d.questionAnswered(question)">\n    </question-builder>\n</ion-slide-box>'),a.put("components/znkExercise/core/template/znkExerciseDrv.html",'<div ng-transclude></div>\n<template-by-platform class="znk-carousel-container"\n                      prefix="components/znkExercise/core/template"\n                      mobile-temp="questionSwiperMobileTemplate.html"\n                      desktop-temp="questionSwiperDesktopTemplate.html">\n</template-by-platform>\n<znk-exercise-btn-section class="btn-section"\n                          prev-question="vm.setCurrentIndexByOffset(-1)"\n                          next-question="vm.setCurrentIndexByOffset(1)"\n                          active-slide="d.currentSlide"\n                          questions="d.questionsWithAnswers">\n\n</znk-exercise-btn-section>\n<znk-exercise-pager\n        ng-hide="d.hidePager"\n        questions="d.questionsWithAnswers"\n        ng-model="d.currentSlide">\n</znk-exercise-pager>\n'),
a.put("components/znkExercise/svg/chevron-icon.svg",'<svg x="0px" y="0px" viewBox="0 0 143.5 65.5">\n    <polyline class="st0" points="6,6 71.7,59.5 137.5,6 "/>\n</svg>\n')}]);