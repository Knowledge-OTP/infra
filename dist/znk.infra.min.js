!function(a){"use strict";a.module("znk.infra",["znk.infra.config","znk.infra.pngSequence","znk.infra.enum","znk.infra.svgIcon","znk.infra.general","znk.infra.scroll","znk.infra.content","znk.infra.znkExercise","znk.infra.storage","znk.infra.utility","znk.infra.exerciseResult","znk.infra.contentAvail","znk.infra.popUp","znk.infra.estimatedScore","znk.infra.stats","znk.infra.hint"])}(angular),function(a){"use strict";a.module("znk.infra.content",[])}(angular),function(a){"use strict";a.module("znk.infra.contentAvail",["znk.infra.config"])}(angular),function(a){"use strict";a.module("znk.infra.enum",[])}(angular),function(a){"use strict";a.module("znk.infra.estimatedScore",["znk.infra.config","znk.infra.znkExercise"]).run(["EstimatedScoreEventsHandlerSrv",function(a){a.init()}])}(angular),function(a){"use strict";a.module("znk.infra.exerciseResult",["znk.infra.config","znk.infra.utility"])}(angular),function(a){"use strict";a.module("znk.infra.general",["znk.infra.enum","znk.infra.svgIcon"]).config(["SvgIconSrvProvider",function(a){var b={"clock-icon":"components/general/svg/clock-icon.svg"};a.registerSvgSources(b)}])}(angular),function(a){"use strict";a.module("znk.infra.hint",["znk.infra.config"])}(angular),function(a){"use strict";a.module("znk.infra.config",[])}(angular),function(a){"use strict";a.module("znk.infra.pngSequence",[])}(angular),function(a){"use strict";a.module("znk.infra.popUp",["znk.infra.svgIcon"]).config(["SvgIconSrvProvider",function(a){var b={"exclamation-mark":"components/popUp/svg/exclamation-mark-icon.svg"};a.registerSvgSources(b)}])}(angular),function(a){"use strict";a.module("znk.infra.scroll",[])}(angular),function(a){"use strict";a.module("znk.infra.stats",["znk.infra.enum","znk.infra.znkExercise"]).run(["StatsEventsHandlerSrv",function(a){a.init()}])}(angular),function(a){"use strict";a.module("znk.infra.storage",[])}(angular),function(a){"use strict";a.module("znk.infra.svgIcon",[])}(angular),function(a){"use strict";a.module("znk.infra.utility",[])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise",["znk.infra.enum","znk.infra.svgIcon","znk.infra.scroll"]).config(["SvgIconSrvProvider",function(a){var b={chevron:"components/znkExercise/svg/chevron-icon.svg",correct:"components/znkExercise/svg/correct-icon.svg",wrong:"components/znkExercise/svg/wrong-icon.svg"};a.registerSvgSources(b)}])}(angular),function(a){function b(){var b;this.setContent=function(a){b=a},this.$get=["$q","$injector",function(c,d){function e(){var a;return function(){return{get:function(){return a?c.when(a):f().then(function(b){return a=b,a.updatePublication(function(b){b.key()!==a.key&&(a.latestRevisions=b.val(),a.key=b.key())}),b})},set:function(b,d){return a.revisionManifest[b]=d,c.when({rev:d.rev,status:"update"})}}}}function f(){return g||(g=d.invoke(b)),g}var g,h=e(),i={};return i.getRev=function(b,d){if(!d||!d.revisionManifest||!d.latestRevisions)return c.when({error:"No Data Found! ",data:d});var e,f=d.revisionManifest[b],g=d.latestRevisions[b];return a.isUndefined(g)?c.when({error:"Not Found",data:d}):(e=f?f.rev<g.rev?{rev:f.rev,status:"old"}:f.rev===g.rev?{rev:g.rev,status:"same"}:{error:"failed to get revision!",data:d}:{rev:g.rev,status:"new"},c.when(e))},i.setRev=function(a,b){return h().set(a,{rev:b})},i.getContent=function(a){if(!a||!a.exerciseType)return c.reject({error:"Error: getContent require exerciseType!"});var b=a.exerciseId?a.exerciseType+a.exerciseId:a.exerciseType;return h().get().then(function(a){return i.getRev(b,a).then(function(d){if(d.error)return c.when(d);if(!a.contentRoot)return c.when({error:"Error: getContent require contentRoot to be defined in config phase!"});if(!a.userRoot)return c.when({error:"Error: getContent require userRoot to be defined in config phase!"});var e=a.contentRoot+b+"-rev-"+d.rev,f=a.create(e);return"new"===d.status&&i.setRev(b,d.rev).then(function(){var c=a.userRoot+"/revisionManifest/"+b,e=a.create(c);e.set({rev:d.rev})}),f.get()})})},i.getAllContentIdsByKey=function(a){var b=[];return h().get().then(function(c){for(var d in c.latestRevisions)-1!==d.indexOf(a)&&b.push(d);return b})},i}]}a.module("znk.infra.content").provider("ContentSrv",b)}(angular),function(a){"use strict";a.module("znk.infra.contentAvail").service("ContentAvailSrv",["$q","$parse","InfraConfigSrv",function(b,c,d){function e(){var a=d.getStorageService(),b=a.variables.appUserSpacePath+"/purchase",c={daily:0,exam:{},tutorial:{},subscription:{}};return a.get(b,c)}function f(){var a=d.getStorageService(),b="freeContent",c={daily:0,exam:{},tutorial:{}};return a.get(b,c)}function g(a){return"id_"+a}function h(a){return a&&a.expiryDate&&a.expiryDate>Date.now()}function i(){return b.all([e(),f()]).then(function(a){var b=a[0],c=h(b.subscription);return c?!0:a})}function j(a,b){var c=g(b);return!(a.exam!==l&&!a.exam[c])}function k(a,b){var d=b.join("."),e=c(d);return!!e(a)}var l="all";this.hasSubscription=function(){return e().then(function(a){return h(a.subscription)})},this.isDailyAvail=function(c){return!a.isNumber(c)||isNaN(c)?b.reject("daily order should be a number"):i().then(function(b){if(b===!0)return!0;var d=b[0],e=b[1];if(e.daily>=c)return!0;if(a.isString(d.daily))return d.daily===l;var f=(d.daily||0)+(e.daily||0);return f>=c})},this.isExamAvail=function(a){return i().then(function(b){if(b===!0)return!0;var c=b[0],d=b[1],e=j(c,a);return e?!0:k(d,["exam",g(a)])})},this.isSectionAvail=function(a,b){return i().then(function(c){if(c===!0)return!0;var d=c[0],e=c[1],f=g(a),h=g(b),i=j(d,a);return i?!0:k(e,["exam",f,"sections",h])})}}])}(angular),function(a){"use strict";a.module("znk.infra.enum").factory("AnswerTypeEnum",["EnumSrv",function(a){return new a.BaseEnum([["SELECT_ANSWER",0,"select answer"],["FREE_TEXT_ANSWER",1,"free text answer"],["RATE_ANSWER",3,"rate answer"]])}])}(angular),function(a){"use strict";a.module("znk.infra.enum").factory("ExamTypeEnum",["EnumSrv",function(a){return new a.BaseEnum([["FULL TEST",0,"test"],["MINI TEST",1,"miniTest"],["DIAGNOSTIC",2,"diagnostic"]])}])}(angular),function(a){"use strict";var b={NEW:0,ACTIVE:1,COMPLETED:2,COMING_SOON:3};a.module("znk.infra.enum").constant("exerciseStatusConst",b),a.module("znk.infra.enum").factory("ExerciseStatusEnum",["EnumSrv",function(a){return new a.BaseEnum([["NEW",b.NEW,"new"],["ACTIVE",b.ACTIVE,"active"],["COMPLETED",b.COMPLETED,"completed"],["COMING_SOON",b.COMING_SOON,"coming soon"]])}])}(angular),function(a){"use strict";a.module("znk.infra.enum").factory("ExerciseTimeEnum",["EnumSrv",function(a){return new a.BaseEnum([["5_MIN",5,"5 min"],["10_MIN",10,"10 min"],["15_MIN",15,"15 min"]])}])}(angular),function(a){"use strict";var b={TUTORIAL:1,PRACTICE:2,GAME:3,SECTION:4,DRILL:5};a.module("znk.infra.enum").constant("exerciseTypeConst",b).factory("ExerciseTypeEnum",["EnumSrv",function(a){return new a.BaseEnum([["TUTORIAL",1,"Tutorial"],["PRACTICE",2,"Practice"],["GAME",3,"Game"],["SECTION",4,"Section"],["DRILL",5,"Drill"]])}])}(angular),function(a){"use strict";a.module("znk.infra.enum").factory("QuestionFormatEnum",["EnumSrv",function(a){var b=new a.BaseEnum([["TEXT",1,"text"],["AUDIO",2,"audio"],["TEXT_AUDIO",3,"text audio"],["PROSE_SUMMARY",4,"prose Summary"],["FILL_IN_TABLE",5,"fill in a table"],["CONNECTING_CONTENT",6,"connecting content"],["INDEPENDENT",7,"independent"],["STANDARD",8,"standard"]]);return b}])}(angular),function(a){"use strict";var b={MATH:0,READING:1,WRITING:2,LISTENING:3,SPEAKING:4,ENGLISH:5,SCIENCE:6};a.module("znk.infra.enum").constant("SubjectEnumConst",b),a.module("znk.infra.enum").factory("SubjectEnum",["EnumSrv",function(a){var c=new a.BaseEnum([["MATH",b.MATH,"math"],["READING",b.READING,"reading"],["WRITING",b.WRITING,"writing"],["LISTENING",b.LISTENING,"listening"],["SPEAKING",b.SPEAKING,"speaking"],["ENGLISH",b.ENGLISH,"english"],["SCIENCE",b.SCIENCE,"science"]]);return c}])}(angular),function(a){a.module("znk.infra.enum").factory("EnumSrv",[function(){function b(a){var b=0,c=1,d=2,e=this;a.forEach(function(a){e[a[b]]={"enum":a[c],val:a[d]}})}var c={};return c.BaseEnum=b,b.prototype.getEnumMap=function(){var a=this,b={},c=Object.keys(a);for(var d in c){var e=c[d],f=a[e];b[f["enum"]]=f.val}return b},b.prototype.getEnumArr=function(){var b=this,c=[];for(var d in b){var e=b[d];a.isObject(e)&&c.push(e)}return c},b.prototype.getValByEnum=function(a){var b,c=this;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];if(e["enum"]===a){b=e.val;break}}return b},c.flashcardStatus=new b([["keep",0,"Keep"],["remove",1,"Remove"]]),c}])}(angular),function(a){"use strict";a.module("znk.infra.estimatedScore").provider("EstimatedScoreEventsHandlerSrv",function(){function b(b,c,d,e){var f={};return a.isDefined(b)&&(f.correctWithin=b),a.isDefined(c)&&(f.correctAfter=c),a.isDefined(d)&&(f.wrongWithin=d),a.isDefined(e)&&(f.wrongAfter=e),f.unanswered=0,f}var c={};this.setDiagnosticScoring=function(a){var d=Object.keys(a);d.forEach(function(d){var e=a[d];c[d]=b.apply(this,e)})};var d={};this.setExerciseRawPoints=function(a,c){d[a]=b.apply(this,c)};var e;this.setAllowedTimeForExercises=function(a){e=a},this.$get=["$rootScope","ExamTypeEnum","EstimatedScoreSrv","SubjectEnum","ExerciseTypeEnum","ExerciseAnswerStatusEnum","exerciseEventsConst","$log",function(b,f,g,h,i,j,k,l){function m(a,b,c){var d;return b===j.unanswered["enum"]?d="unanswered":(d=b===j.correct["enum"]?"correct":"wrong",d+=c?"Within":"After"),a[d]}function n(a,b){var d=c[a.difficulty],e=b.isAnsweredCorrectly?j.correct["enum"]:j.wrong["enum"];return m(d,e,!0)}function o(a,b){var c=0,d=a.questions;for(var e in b.questionResults){var f=d[e],h=b.questionResults[e];c+=n(f,h)}g.setDiagnosticSectionScore(c,i.SECTION["enum"],a.subjectId,a.id)}function p(b,c){var e,f;a.isDefined(c.answerAfterTime)?(e=!1,f=c.answerAfterTime):(e=!0,f=j.convertSimpleAnswerToAnswerStatusEnum(c.isAnsweredCorrectly));var g=d[b];return m(g,f,e)}function q(b,c,f){d[b]||l.error("EstimatedScoreEventsHandlerSrv: raw scoring not exits for the following exercise type: "+b);var g=c.questionResults,h={total:g.length*d[b].correctWithin,earned:0},i=a.isDefined(f)?f:e[b];a.isUndefined(i)&&l.error("EstimatedScoreEventsHandlerSrv: allowed time missing for the following exercise type: "+b);var j=i>=c.duration;return g.forEach(function(a){h.earned+=p(b,a,j)}),h}function r(a,b,c,d){var e=q(a,d);g.addRawScore(e,a,c.subjectId,c.id)}a.equals({},c)&&l.error("EstimatedScoreEventsHandlerSrv: diagnosticScoring was not set !!!"),a.equals({},d)&&l.error("EstimatedScoreEventsHandlerSrv: diagnosticScoring was not set !!!"),e||l.error("EstimatedScoreEventsHandlerSrv: allowedTimeForExercisesMap was not set !!!");var s={},t=b.$new(!0);t.$on(k.section.FINISH,function(a,b,c,d){var e=d.typeId===f.DIAGNOSTIC["enum"];e&&o(b,c);var h=q(i.SECTION["enum"],c,b.time);g.addRawScore(h,i.SECTION["enum"],b.subjectId,b.id,e)});var u=[{name:k.drill.FINISH,type:i.DRILL["enum"]},{name:k.tutorial.FINISH,type:i.TUTORIAL["enum"]},{name:k.game.FINISH,type:i.GAME["enum"]}];return u.forEach(function(a){t.$on(a.name,r.bind(s,a.type))}),s.init=a.noop,s}]})}(angular),function(a){"use strict";a.module("znk.infra.estimatedScore").service("EstimatedScoreHelperSrv",["SubjectEnum","InfraConfigSrv",function(b,c){function d(c,d){var e=Object.keys(b);for(var f in e){var g=b[e[f]];c[g["enum"]]=a.copy(d)}}var e=this,f=c.getStorageService(),g=f.variables.appUserSpacePath+"/estimatedScore";e.getEstimatedScoreData=function(){return e.getEstimatedScoreData.prom||(e.getEstimatedScoreData.prom=f.get(g).then(function(b){var c={estimatedScores:{},sectionsRawScores:{},exercisesRawScores:{},processedExercises:[]};d(c.estimatedScores,[]),d(c.sectionsRawScores,[]);var e={total:0,earned:0};return d(c.exercisesRawScores,e),a.forEach(c,function(c,d){if(a.isUndefined(b[d])&&(b[d]=c),b[d]!==c&&a.isObject(c)){var e=b[d];a.forEach(c,function(b,c){a.isUndefined(e[c])&&(e[c]=b)})}}),b})),e.getEstimatedScoreData.prom},e.setEstimateScoreData=function(a){return f.set(g,a)}}])}(angular),function(a){a.module("znk.infra.estimatedScore").provider("EstimatedScoreSrv",function(){var b;this.setSubjectsRawScoreEdges=function(a){b=a};var c;this.setRawScoreToRealScoreFn=function(a){c=a};var d,e;this.setMinMaxDiagnosticScore=function(a,b){d=a,e=b},this.$get=["EstimatedScoreHelperSrv","ExerciseTypeEnum","$injector","$q","SubjectEnum","$log",function(f,g,h,i,j,k){function l(b,c){return f.getEstimatedScoreData().then(function(d){return a.isUndefined(c)?d[b]:d[b][c]})}function m(c,d,e){var f=0,g=0,h=0;c.forEach(function(a,b){h+=a.total;var c=+b+1;f+=a.total*c,g+=a.earned*c});var i={total:h,earned:h*g/f},j=2/3*i.earned+1/3*d.earned,l=2/3*i.total+1/3*d.total,m=b[e];a.isUndefined(m)&&k.error("EstimatedScoreSrv: subjectRawScoreEdges was not defined for the following subject: "+e);var n=m.max*j/l;return Math.max(n,m.min)}function n(a,b,c,d){return q(a,b).then(function(a){return c?d&&Math.abs(a-c)>.05*a?c+(a-c>0?1:-1)*a*.05:+a.toFixed(2):a})}function o(a,b,c){var d=b+"_"+c;return-1!==a.processedExercises.indexOf(d)?!0:void a.processedExercises.push(d)}b||k.error("EstimatedScoreSrv: subjectsRawScoreEdges was not set"),c||k.error("EstimatedScoreSrv: rawScoreToScoreFnGetter was not set !!!");var p={},q=function(){var a=h.invoke(c);return function(b,c){return i.when(a(b,c))}}();return p.getEstimatedScores=l.bind(this,"estimatedScores"),p.getSectionsRawScores=l.bind(this,"sectionsRawScores"),p.getExercisesRawScore=l.bind(this,"exercisesRawScores"),p.getLatestEstimatedScore=function(b){return l("estimatedScores",b).then(function(c){if(a.isDefined(b))return c.length?c[c.length-1]:{};var d={};return a.forEach(c,function(a,b){d[b]=a.length?a[a.length-1]:{}}),d})},p.setDiagnosticSectionScore=function(a,b,c,g){return f.getEstimatedScoreData().then(function(h){return h.estimatedScores[c].length?i.reject("Exercise already processed type "+b+" id "+g):(a=Math.max(d,Math.min(e,a)),h.estimatedScores[c].push({exerciseType:b,exerciseId:g,score:a,time:Date.now()}),f.setEstimateScoreData(h).then(function(){return h.estimatedScores[c][h.estimatedScores[c].length-1]}))})},p.addRawScore=function(b,c,d,e,h){return f.getEstimatedScoreData().then(function(f){if(o(f,c,e))return i.reject("Exercise already processed type "+c+" id "+e);if(c===g.SECTION["enum"]){var j=f.sectionsRawScores[d],k={exerciseType:c,exerciseId:e,time:Date.now()};a.extend(k,b),j.push(k)}else{var l=f.exercisesRawScores[d];l.exerciseType=c,l.exerciseId=e,l.time=Date.now(),l.total+=b.total,l.earned+=b.earned}if(!h){var p=m(f.sectionsRawScores[d],f.exercisesRawScores[d],d),q=f.estimatedScores[d],r=q[q.length-1]||{};return n(d,p,r.score,c!==g.SECTION["enum"]).then(function(a){return f.estimatedScores[d].push({exerciseType:c,exerciseId:e,score:a,time:Date.now()}),f})}return f}).then(function(a){return f.setEstimateScoreData(a)})},p}]})}(angular),function(a){"use strict";a.module("znk.infra.exerciseResult").service("ExerciseResultSrv",["InfraConfigSrv","$log","$q","UtilitySrv","ExerciseTypeEnum","StorageSrv","ExerciseStatusEnum",function(b,c,d,e,f,g,h){function i(a){return v+"/"+a}function j(a,c,d){var e=b.getStorageService();return{exerciseId:c,exerciseTypeId:a,startedTime:e.variables.currTimeStamp,questionResults:[],guid:d}}function k(a){var c=i(a),d=b.getStorageService();return d.get(c)}function l(){var a=b.getStorageService();return a.get(w)}function m(a){return x+"/"+a}function n(c,d){var f=b.getStorageService(),g=m(c);return f.get(g).then(function(b){var f=o(d,c);return b.guid!==c?a.extend(b,f):e.object.extendWithoutOverride(b,f),b})}function o(a,b){return{isComplete:!1,startedTime:"%currTimeStamp%",examId:a,guid:b,sectionResults:{}}}function p(){var a=b.getStorageService();return a.get(y)}function q(){var a=this,c=s(),e={},j=a.questionResults.reduce(function(a,b){return a+(b.timeSpent||0)},0);a.duration=j;var k=a.questionResults.length;a.avgTimePerQuestion=k?Math.round(j/k):0;var l=i(a.guid);return e[l]=a,c.then(function(c){c[a.exerciseTypeId]||(c[a.exerciseTypeId]={});var i=a.isComplete?h.COMPLETED["enum"]:h.ACTIVE["enum"];c[a.exerciseTypeId][a.exerciseId]=new t(i),e[z]=c;var j=d.when();return i===h.COMPLETED["enum"]&&a.exerciseTypeId===f.SECTION["enum"]&&(j=u.getExamResult(a.examId).then(function(a){if(r(a,c)){a.isComplete=!0,a.endedTime=g.variables.currTimeStamp;var b=m(a.guid);e[b]=a}})),j.then(function(){var c=b.getStorageService();return c.set(e),a})})}function r(a,b){var c=b[f.SECTION["enum"]],d=Object.keys(a.sectionResults);if(d.length!==+a.examSectionsNum)return!1;for(var e=0,g=d.length;g>e;e++){var i=d[e],j=c[i].status===h.COMPLETED["enum"];if(!j)return!1}return!0}function s(){var a=b.getStorageService();return a.get(z)}function t(a){this.status=a}var u=this,v="exerciseResults",w=g.variables.appUserSpacePath+"/exerciseResults",x="examResults",y=g.variables.appUserSpacePath+"/examResults",z=g.variables.appUserSpacePath+"/exercisesStatus";this.getExerciseResult=function(c,g,h,n){var o;return c===f.SECTION["enum"]&&(o=u.getExamResult(h)),l().then(function(f){var l=f[c]&&f[c][g];if(!l){f[c]||(f[c]={});var p=b.getStorageService(),q=e.general.createGuid(),r={};f[c][g]=q,r[w]=f;var s=i(q),t=j(c,g,q);r[s]=t;var u;return o&&(t.examId=h,u=o.then(function(a){a.sectionResults||(a.sectionResults={}),n&&!a.examSectionsNum&&(a.examSectionsNum=n),a.sectionResults[g]=q;var b=m(a.guid);r[b]=a})),d.when(u).then(function(){return p.set(r)}).then(function(a){return a[s]})}return k(l).then(function(b){var d=j(c,g,l);return b.guid!==l?a.extend(b,d):e.object.extendWithoutOverride(b,d),b})}).then(function(a){return a.$save=q,a})},this.getExamResult=function(a){var c=b.getStorageService();return p().then(function(b){var d=b[a];if(!d){var f={},g=e.general.createGuid();b[a]=g,f[y]=b;var h=m(g),i=o(a,g);return f[h]=i,c.set(f).then(function(a){return a[h]})}return n(d,a)})},this.getExerciseStatus=function(a,b){return s().then(function(c){return c[a]&&c[a][b]?c[a][b]:new t(h.NEW["enum"])})}}])}(angular),function(a){a.module("znk.infra.general").directive("compile",["$compile","$animate",function(b,c){return{link:function(d,e,f){var g,h=d.$watch(f.compile,function(i){if(g&&(g.$destroy(),g=null),c.leave(e.children()),e.empty(),"undefined"!=typeof i){d.$eval(f.bindOnce)&&h(),"string"!=typeof i&&(null===i&&(i=""),i=""+i);var j=/^<(\w+)( .*|)>(.|\n)*(<\/\1>|)$/;if(j.test(i)){g=d.$new();var k=a.element(i);c.enter(k,e),b(e.children())(g)}else e.append(i)}})}}}])}(angular),function(a){"use strict";a.module("znk.infra.general").directive("subjectIdToAttrDrv",["SubjectEnum","$interpolate",function(b,c){return{link:{pre:function(d,e,f){var g=d.$watch(f.subjectIdToAttrDrv,function(h){var i=f.contextAttr?c(f.contextAttr)(d):void 0,j=f.prefix?c(f.prefix)(d):void 0,k=f.suffix?c(f.suffix)(d):void 0;if(!a.isUndefined(h)){g();var l;i?l=i.split(","):(l=[],l.push("class"));var m=j?j.split(","):[],n=k?k.split(","):[],o=b.getEnumMap(),p=o[h];a.forEach(l,function(a,b){var c=p;m.length&&(c=(m[b]||m[0])+"-"+c),n.length&&(c+="-"+(n[b]||n[0])),c=c.replace(/\s+/g,""),a=a.replace(/\s+/g,""),"class"===a?e.addClass(c):e.attr(a,c)})}})}}}}])}(angular),function(a){"use strict";a.module("znk.infra.general").directive("subjectIdToClassDrv",["SubjectEnum",function(b){return{priority:1e3,link:{pre:function(c,d,e){var f=c.$watch(e.subjectIdToClassDrv,function(c){if(!a.isUndefined(c)){f();var g;for(var h in b)if(b[h]["enum"]===c){g=b[h].val,e.classSuffix&&(g+=e.classSuffix);break}d.addClass(g)}})}}}}])}(angular),function(a){a.module("znk.infra.general").directive("timer",["$interval",function(b){var c={REGULAR:1,ROUND_PROGRESSBAR:2};return{scope:{play:"&",typeGetter:"&?type",configGetter:"&?config"},require:"?ngModel",replace:!0,templateUrl:"components/general/templates/timerDrv.html",link:function(d,e,f,g){function h(a){return(""+Math.abs(+a)).length<2?(0>a?"-":"")+"0"+Math.abs(+a):a}function i(a,b){var c=a/1e3,d=Math.floor(c%60),e=Math.floor(Math.abs(c)/60)*(0>c?-1:1),f=h(d),g=h(e);return b.replace("tss",c).replace("ss",f).replace("mm",g)}function j(a){var b,c=i(a,d.config.format);switch(d.type){case 1:b=l.querySelector(".timer-view");break;case 2:b=l.querySelector(".timer-display")}b&&(b.innerText=c)}function k(){var b=g.$viewValue;a.isUndefined(b)||(b+=d.config.countDown?-n:n,j(b),g.$setViewValue(b))}var l=e[0];d.ngModelCtrl=g;var m,n=1e3;d.type=d.typeGetter()||1,d.config=d.configGetter()||{};var o={format:"mm:ss"};switch(d.config=a.extend(o,d.config),d.type){case c.ROUND_PROGRESSBAR:var p={stroke:3,bgcolor:"#0a9bad",color:"#e1e1e1"};d.config=a.extend(p,d.config),d.config.radius=d.config.radius||Math.floor(e[0].offsetHeight/2)||45}g.$render=function(){var b=g.$viewValue;a.isUndefined(b)||j(b)},d.$watch("play()",function(a){m&&b.cancel(m),a&&(m=b(k,n,0,!1))}),d.$on("$destroy",function(){b.cancel(m)})}}}])}(angular),function(a){"use strict";a.module("znk.infra.hint").provider("HintSrv",function(){var b={};this.registerHint=function(a,c,d){b[a]||(b[a]={name:a,action:c,determineWhetherToTriggerGetter:d})},this.$get=["InfraConfigSrv","$q","$log","$injector",function(c,d,e,f){function g(b){return a.isUndefined(b)||!b.value}function h(){return l.get(m).then(function(b){var c={hintsStatus:{}};for(var d in c)a.isUndefined(b[d])&&(b[d]=c[d]);return b})}function i(a){return l.set(m,a)}function j(a){return a&&a.history&&a.history.length&&a.history[a.history.length-1]}var k={},l=c.getStorageService(),m=l.variables.appUserSpacePath+"/hint";return k.triggerHint=function(c){var k=b[c];return k||e.error("HintSrv: the following hint is not registered "+c),h().then(function(b){var e,h=b.hintsStatus,m=j(h[c]);return e=k.determineWhetherToTriggerGetter?f.invoke(k.determineWhetherToTriggerGetter):g,d.when(e(m)).then(function(e){if(e){var g=f.invoke(k.action);return d.when(g(m)).then(function(d){return h[c]||(h[c]={name:c,history:[]}),h[c].history.push({value:a.isUndefined(d)?!0:d,date:l.variables.currTimeStamp}),b.hintsStatus=h,i(b),d})}})})},k}]})}(angular),function(a){"use strict";a.module("znk.infra.config").provider("InfraConfigSrv",[function(){var a;this.setStorageServiceName=function(b){a=b},this.$get=["$injector","$log",function(b,c){var d={};return d.getStorageService=function(){return a?b.get(a):void c.debug("InfraConfigSrv: storage service name was not defined")},d}]}])}(angular),function(a){"use strict";a.module("znk.infra.pngSequence").directive("pngSequence",["$timeout","ExpansionSrcSrv","$window",function(b,c,d){return{restrict:"E",scope:{onEnded:"&",loop:"&",speed:"&",autoPlay:"&",actions:"="},link:function(e,f,g){function h(){var a,b=+g.startIndex,d=+g.endIndex;n=d-b;for(var e=b;d>e;e++){a=100>e||10>e?10>e?"00"+e:"0"+e:e;var h="<div  style=\"background-image: url('"+c.getExpansionSrc(g.imgData+a+".png")+"'); background-size: cover; will-change: opacity; opacity:0; position: absolute; top:0; left:0;\"></div>";f.append(h)}}function i(){f.empty()}function j(){this.index=0,this.imagesDomElem=f[0].children,this.lastTimestamp=!1}function k(c){this.index!==n-1||e.loop()?this.lastTimestamp&&c-this.lastTimestamp<40?o=d.requestAnimationFrame(k.bind(this)):(this.imagesDomElem[this.index].style.opacity=0,this.index=(this.index+1)%n,this.imagesDomElem[this.index].style.opacity=1,this.lastTimestamp=c,o=d.requestAnimationFrame(k.bind(this))):b(function(){var b=f.children();a.element(b[b.length-1]).css("display","none"),e.onEnded()})}function l(){if(i(),g.imgData&&a.isDefined(g.startIndex)&&g.endIndex&&(h(),e.autoPlay())){var b=new j;o=d.requestAnimationFrame(k.bind(b))}}function m(){return g.imgData+"_"+g.startIndex+"_"+g.endIndex+"_"+g.rotate}var n,o;e.$watch(m,l),e.actions=e.actions||{},e.actions.play=function(){b(function(){var a=new j;o=d.requestAnimationFrame(k.bind(a))},0,!1)},e.actions.reset=i,e.$on("$destroy",function(){d.cancelAnimationFrame(o)})}}}])}(angular),function(){angular.module("znk.infra.popUp").factory("PopUpSrv",["$injector","$q","$rootScope","$animate","$document",function(a,b,c,d,e){function f(a,b,c,d,e){a=a?a+" base-popup show-hide-animation":"base-popup show-hide-animation",b=b||"";var f='<div class="icon-wrapper"><svg-icon name="%headerIcon%"></svg-icon></div>';f=f.replace("%headerIcon%",b);var g='<div class="title responsive-title">%title%</div><div class="content">%content%</div>';return c=c||"",g=g.replace("%title%",c),d=d||"",g=g.replace("%content%",d),h.popup(a,f,g,e)}function g(a,b,c,d){var e={text:a||"",type:b||""};return d?e.rejectVal=d:e.resolveVal=c,e}var h={},i=angular.element(e[0].body),j=angular.element('<div class="znk-popup"></div>');i.append(j);var k,l;return h.closePopup=function(a,b){b||(b="closed"),j.empty(),k.scope&&k.scope.$destroy(),l[a?"reject":"resolve"](b)},h.popup=function(e,f,g,i){k&&h.closePopup();var m=c.$new(!0);m.d={},l=b.defer(),k={},k.promise=l.promise;var n='<div class="%wrapperCls%"><div class="znk-popup-wrapper"><div class="znk-popup-header">%header%</div><div class="znk-popup-body">%body%</div><div class="znk-popup-buttons"><div ng-repeat="button in ::d.buttons" class="button-wrapper"><div class="btn" ng-click="d.btnClick(button)" ng-class="button.type" analytics-on="click" analytics-event="click-popup-{{button.text}}" analytics-category="popup">{{button.text}}</div></div></div></div></div>';e=e?" "+e:"",n=n.replace("%wrapperCls%",e),f=f||"",n=n.replace("%header%",f),g=g||"",n=n.replace("%body%",g),angular.isDefined(i)&&!angular.isArray(i)&&(i=[i]),m.d.buttons=i,m.d.btnClick=function(a){a.hasOwnProperty("rejectVal")?m.d.close(a.rejectVal,!0):m.d.close(a.resolveVal)},m.d.close=function(a,b){var c=d.leave(o);c.then(function(){if(m&&(m.$destroy(),m=null),k=null,angular.isDefined(l)&&null!==l){var c=b?"reject":"resolve";a=a||"close",l[c]&&l[c](a),l=null}})};var o=angular.element(n);d.enter(o,j);var p=a.get("$compile");return p(j.contents())(m),k},h.error=function(a,b){var c=new g("OK",null,"ok");return f("error-popup","exclamation-mark",a||"OOOPS...",b,[c])},h.ErrorConfirmation=function(a,b,c,d){var e=[new g(c,null,c),new g(d,"btn-outline",void 0,d)];return f("error-popup","exclamation-mark",a,b,e)},h.success=function(a,b){var c=new g("OK",null,"ok");return f("success-popup","exclamation-mark",a||"",b,[c])},h.warning=function(a,b,c,d){var e=[new g(c,null,c),new g(d,"btn-outline",void 0,d)];return f("warning-popup","exclamation-mark",a,b,e)},h.isPopupOpen=function(){return!!k},h}])}(),function(a){"use strict";a.module("znk.infra.scroll").directive("znkScroll",["$log","$window","$timeout","$interpolate",function(b,c,d,e){function f(c,d,e,f,h){var i=a.isArray(c)?c[0]:c,j=d;if(e){var k,l=i.style.transform,m=l.match(/translateX\((.*)px\)/);!a.isArray(m)||m.length<2?(b.debug("failed to math transform value"),k=0):k=+m[1],j+=k}f=a.isUndefined(f)?-(1/0):f,h=a.isUndefined(h)?1/0:h,j=Math.max(j,f),j=Math.min(j,h);var n="translateX("+j+"px)";g(i,"transform",n)}function g(b,c,d){var e=a.isArray(b)?b[0]:b;null===d?e.style[c]="":e.style[c]=d}function h(b){var d=a.isArray(b)?b[0]:b,e=c.getComputedStyle(d),f=+e.marginRight.replace("px",""),g=+e.marginLeft.replace("px","");return d.offsetWidth+f+g}return{restrict:"E",compile:function(c){function i(a){b.debug("mouse move",a.pageX);var c=a.pageX-n.x;n.x=a.pageX,n.y=a.pageY,l(c,o,p)}function j(a){b.debug("mouse up",a.pageX),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",j),o=null,p=null,n=null}function k(a){b.debug("mouse down",a.pageX);var c=q.children[0];c&&(o=q.offsetWidth,p=h(c),n={x:a.pageX,y:a.pageY},document.addEventListener("mousemove",i),document.addEventListener("mouseup",j))}function l(a,b,c){var d=Math.min(b-c,0),e=0,g=q.children[0];g.style.transform||f(g,0,!1,!1,d,e),f(g,a,!0,d,e)}function m(a){var b=q.offsetWidth,c=q.children[0],d=h(c),e=Math.min(b-d,0),g=0;f(c,a,!1,e,g)}var n,o,p,q=c[0];return q.addEventListener("mousedown",k),{pre:function(c,j,n){function o(a){b.debug("mouse wheel event",a),l(-a.deltaY,t,u)}function p(){b.debug("mouse enter"),t=q.offsetWidth,u=h(q.children[0]),q.addEventListener("mousewheel",o)}function r(){b.debug("mouse leave"),q.removeEventListener("mousewheel",o)}var s=q.children[0];s&&f(s,0);var t,u,v="false"!==e(n.scrollOnMouseWheel||"")(c);if(v&&(q.addEventListener("mouseenter",p),q.addEventListener("mouseleave",r)),n.actions){a.isUndefined(c.$eval(n.actions))&&c.$eval(n.actions+"={}");var w=c.$eval(n.actions);w.animate=function(a,b,c){if(b&&c){var e="transform "+b+"ms "+c;g(s,"transition",e)}m(a),d(function(){g(s,"transition",null)},b,!1)}}c.$on("$destroy",function(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),q.removeEventListener("mousedown",k),q.removeEventListener("mouseenter",p),q.removeEventListener("mouseleave",r),q.removeEventListener("mousewheel",o)})}}}}}])}(angular),function(a){"use strict";a.module("znk.infra.stats").factory("StatsEventsHandlerSrv",["$rootScope","exerciseEventsConst","StatsSrv","ExerciseTypeEnum","$log","SubjectEnum","QuestionFormatEnum",function(b,c,d,e,f,g,h){function i(b,c,e,i){return d.isExerciseStatsRecorded(b,e.id).then(function(c){if(!c){var j={};return i.questionResults.forEach(function(b,c){var i=e.questions[c],k=i.categoryId;if(i.subjectId!==g.WRITING["enum"]||i.questionFormatId===h.STANDARD["enum"]){if(isNaN(+k)||null===k)return void f.error("StatsEventsHandlerSrv: _eventHandler: bad category id for the following question: ",i.id,k);j[k]||(j[k]=new d.BaseStats);var l=j[k];l.totalQuestions++,l.totalTime+=b.timeSpent||0,a.isUndefined(b.userAnswer)?l.unanswered++:b.isAnsweredCorrectly?l.correct++:l.wrong++}}),d.updateStats(j,b,e.id)}})}var j={},k=b.$new(!0),l=[],m=e.getEnumArr();return m.forEach(function(a){var b=a.val.toLowerCase();l.push({evt:c[b].FINISH,exerciseType:a["enum"]})}),l.forEach(function(a){k.$on(a.evt,i.bind(j,a.exerciseType))}),j.init=a.noop,j}])}(angular),function(a){"use strict";a.module("znk.infra.stats").factory("StatsQuerySrv",[function(){var a={};return a}])}(angular),function(a){"use strict";a.module("znk.infra.stats").provider("StatsSrv",function(){var b;this.setCategoryLookup=function(a){b=a},this.$get=["InfraConfigSrv","$q","SubjectEnum","$log","$injector",function(c,d,e,f,g){function h(){return g.invoke(b)}function i(b,c){a.isDefined(b)&&(this.id=+b);var d,e,f,g,h;c?(d=5,e=1,f=0,g=4,h=0):(d=0,e=0,f=0,g=0,h=0),this.totalQuestions=d,this.correct=e,this.unanswered=f,this.wrong=g,this.totalTime=h}function j(){var a={processedExercises:{}};return q.get(r,a)}function k(a){return q.set(r,a)}function l(a,b){a.totalQuestions+=b.totalQuestions,a.correct+=b.correct,a.unanswered+=b.unanswered,a.wrong+=b.wrong,a.totalTime+=b.totalTime}function m(a,b){return a[b]?a[b].parentId:a[b]}function n(a){return"level"+a+"Categories"}function o(a){return"id_"+a}function p(a,b){return a+"_"+b}b||f.error("StatsSrv: getCategoryLookup was not set !!!!");var q=c.getStorageService(),r=q.variables.appUserSpacePath+"/stats",s={};return s.getStats=j,s.BaseStats=i,s.updateStats=function(b,c,e){var f=h(),g=j(),q=p(c,e);return d.all([f,g]).then(function(c){var d=c[0],e=c[1],f=e.processedExercises[q];return f?void 0:(a.forEach(b,function(b,c){for(var f=[],g=+c;null!==g&&a.isDefined(g);)f.unshift(g),g=m(d,g);f.forEach(function(a,c){var d=c+1,g=n(d),h=e[g];h||(h={},e[g]=h);var j=o(a),k=h[j];if(!k){k=new i(a,!0);var m=f.slice(0,c);m.length&&(m.reverse(),k.parentsIds=m),h[j]=k}l(k,b)})}),e.processedExercises[q]=!0,k(e))})},s.isExerciseStatsRecorded=function(a,b){return s.getStats().then(function(c){var d=p(a,b);return!!c.processedExercises[d]})},s.getPerformanceData=function(){return s.getStats().then(function(a){var b=a.subjectStats,c=a.generalCategoryStats,d={},g={},h=Object.keys(c),i={};return h.forEach(function(a){var b=c[a];if(!b)return void f.error("StatsSrv: getPerformanceData: null general category stat was received for the following key: ",a);g[b.subjectId]||(g[b.subjectId]=[]);var d={id:b.id,levelProgress:b.totalQuestions?Math.round(b.correct/b.totalQuestions*100):0,avgTime:b.totalTime?Math.round(b.totalTime/b.totalQuestions/1e3):0,answeredQuestions:b.totalQuestions};g[b.subjectId].push(d);var e=i[b.subjectId];(!e||e.successRate>d.levelProgress)&&(i[b.subjectId]={
id:d.id,successRate:d.levelProgress})}),e.getEnumArr().forEach(function(a){var c=a["enum"],e=d[c]={};e.category=g[c],e.weakestCategory=i[c];var f=b[c];f&&(e.overall={value:f.totalQuestions?Math.round(f.correct/f.totalQuestions*100):0,avgTime:f.totalTime?Math.round(f.totalTime/f.totalQuestions/1e3):0})}),d})},s}]})}(angular),function(a){"use strict";a.module("znk.infra.storage").factory("storageFirebaseAdapter",["$log","$q","StorageSrv",function(b,c,d){function e(c){if(a.isArray(c))return void c.forEach(function(b,d){a.isUndefined(b)&&(c[d]=null),e(b)});if(a.isObject(c)){var d=Object.keys(c);return void d.forEach(function(d){var f=c[d];return"$"===d[0]||a.isUndefined(f)||a.isArray(f)&&!f.length?(b.debug("storageFirebaseAdapter: illegal property was deleted before save",d),void delete c[d]):(a.isString(f)&&(c[d]=h(f)),void e(f))})}}function f(d){function f(a){var b=g(a,j);return k[b]||(k[b]=k.rootRef.child(b)),k[b]}function h(a){var d=c.defer(),e=f(a);return e.once("value",function(a){d.resolve(a.val())},function(c){b.debug("storageFirebaseAdapter: failed to retrieve data for the following path",a,c),d.reject(c)}),d.promise}function i(d,h){var i=c.defer();if(a.isObject(d)){var l={};a.forEach(d,function(b,c){var d=g(c,j);l[d]=a.copy(b)}),e(l),k.rootRef.update(l,function(a){a&&i.reject(a),i.resolve()})}else{var m=a.copy(h);e(m);var n=f(d);n.set(m,function(a){a?(b.debug("storageFirebaseAdapter: failed to set data for the following path",d,a),i.reject(a)):i.resolve(m)})}return i.promise}var j,k={},l=new Firebase(d);return k.rootRef=l,l.onAuth(function(a){j=a}),{get:h,set:i,__refMap:k}}function g(a,b){var c=a.replace(k,b.uid);return c}function h(a){return a===d.variables.currTimeStamp?Firebase.ServerValue.TIMESTAMP:a}var i=d.variables,j=i.uid.replace(/\$/g,"\\$"),k=new RegExp(j,"g");return f.processPath=function(a,b){var c=a.replace(k,b.uid);return c},f}])}(angular),function(a){"use strict";a.module("znk.infra.storage").factory("StorageSrv",["$cacheFactory","$q",function(b,c){function d(a,b){this.getter=function(b){return c.when(a(b))},this.setter=function(a,d){return c.when(b(a,d))}}function e(a,b,c){this.path=a,this.defaultValue=b,this.storage=c}var f={},g=b("entityCache");return d.prototype.get=function(b,d){var e,h=this,i=g.get(b);d=d||{};var j=!1;if(i)e=c.when(i);else{if(f[b])return f[b];j=!0,e=this.getter(b).then(function(c){return c=a.isUndefined(c)||null===c?{}:c,g.put(b,c),delete f[b],c})}return e=e.then(function(c){var e=Object.keys(d);return e.forEach(function(b){a.isUndefined(c[b])&&(c[b]=a.copy(d[b]))}),a.isObject(c)&&!c.$save&&(c.$save=h.set.bind(h,b,c)),c}),j&&(f[b]=e),e},d.prototype.set=function(b,c){var d=this;return this.setter(b,c).then(function(){var e={};return a.isObject(b)?e=b:e[b]=c,a.forEach(e,function(b,c){g.put(c,b),a.isObject(b)&&!b.$save&&(b.$save=d.set.bind(d,c,b))}),a.isObject(b)?e:e[b]})},d.prototype.entityCommunicator=function(a,b){return new e(a,b,this)},d.variables=d.prototype.variables={currTimeStamp:"%currTimeStamp%",uid:"$$uid",appUserSpacePath:"users/$$uid"},e.prototype.get=function(){return this.storage.get(this.path)},e.prototype.set=function(a){return this.storage.set(this.path,a)},d}])}(angular),function(a){"use strict";a.module("znk.infra.svgIcon").directive("svgIcon",["$log","SvgIconSrv",function(a,b){return{scope:{name:"@"},link:{pre:function(a,c){a.$watch(function(){return c.attr("name")},function(){var a=c.attr("name");c.addClass(a),b.getSvgByName(a).then(function(a){c.append(a)})})}}}}])}(angular),function(a){"use strict";a.module("znk.infra.svgIcon").provider("SvgIconSrv",[function(){var b={};this.setConfig=function(c){a.extend(b,c)};var c={};this.registerSvgSources=function(b){var d=Object.keys(c);return d.forEach(function(a){b[a]&&console.log("SvgIconSrv: svg icon was already defined before ",a)}),a.extend(c,b),!0};var d={};this.$get=["$templateCache","$q","$http",function(a,b,e){var f={};return f.getSvgByName=function(f){var g=c[f];if(d[g])return d[g];var h=a.get(g);if(h)return b.when(h);var i=e.get(g).then(function(b){return a.put(g,b.data),delete d[g],b.data});return d[g]=i,i},f}]}])}(angular),function(a){"use strict";a.module("znk.infra.utility").factory("UtilitySrv",[function(){var b={};return b.general={},b.general.createGuid=function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(a()+a()+"-"+a()+"-4"+a().substr(0,3)+"-"+a()+"-"+a()+a()+a()).toLowerCase()},b.object={},b.object.extendWithoutOverride=function(b,c){a.forEach(c,function(a,c){b.hasOwnProperty(c)||(b[c]=a)})},b.array={},b.array.convertToMap=function(b,c){a.isUndefined(c)&&(c="id");var d={};return b.forEach(function(a){d[a[c]]=a}),d},b}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("answerBuilder",["$compile","AnswerTypeEnum","ZnkExerciseUtilitySrv","ZnkExerciseViewModeEnum",function(b,c,d,e){var f={};return f[c.SELECT_ANSWER["enum"]]="<select-answer></select-answer>",f[c.FREE_TEXT_ANSWER["enum"]]="<select-answer></select-answer>",f[c.RATE_ANSWER["enum"]]="<rate-answer></rate-answer>",{require:["answerBuilder","^questionBuilder","^ngModel"],restrict:"E",controller:[function(){}],link:{pre:function(c,g,h,i){var j=i[0],k=i[1],l=i[2],m=["getViewMode"];d.bindFunctions(j,k,m),j.canUserAnswerBeChanged=function(){var b=k.getViewMode(),c=b!==e.REVIEW["enum"],d=a.isDefined(l.$viewValue),f=b===e.ANSWER_WITH_RESULT["enum"];return c&&f&&d},j.question=k.question;var n=k.question.answerTypeId,o=f[n];g.html(o),b(g.contents())(c)}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("rateAnswer",["ZnkExerciseViewModeEnum",function(b){return{templateUrl:"components/znkExercise/answerTypes/templates/rateAnswerDrv.html",require:["^answerBuilder","^ngModel"],scope:{},link:function(c,d,e,f){function g(a){l.canUserAnswerBeChanged()||(m.$setViewValue(a),h())}function h(){var b=a.element(k.querySelector(".selected"));b.removeClass("selected");var c=m.$viewValue,d=a.element(r[c]);d.addClass("selected");var e=s.length-1;if(n===o&&a.isNumber(c)||n===p){for(var f=0;e>f;f++)a.element(r[s[f].id-q]).addClass("correct");a.element(r[s[e].id-q]).addClass("correct-edge")}!a.isNumber(c)||n!==p&&n!==o||(c>=s[0].id-q&&c<=s[e].id-q?a.element(r[c]).addClass("selected-correct"):a.element(r[c]).addClass("selected-wrong"))}function i(a){return a-q}function j(a){return a+q}var k=d[0],l=f[0],m=f[1],n=l.getViewMode(),o=b.ANSWER_WITH_RESULT["enum"],p=b.REVIEW["enum"],q=2;c.d={},c.d.itemsArray=new Array(11);var r,s=l.question.correctAnswerText,t=c.$watch(function(){return d[0].querySelectorAll(".item-repeater")},function(b){b&&(t(),r=b,n===p?(c.clickHandler=a.noop,h(c.d.answers)):c.clickHandler=g,m.$render=function(){h()},m.$render())});m.$formatters.push(i),m.$parsers.push(j)}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("selectAnswer",["$timeout","ZnkExerciseViewModeEnum","ZnkExerciseAnswersSrv",function(b,c,d){return{templateUrl:"components/znkExercise/answerTypes/templates/selectAnswerDrv.html",require:["^answerBuilder","^ngModel"],restrict:"E",scope:{},link:function(e,f,g,h){function i(b){for(var c=k.$viewValue,d=j.question.correctAnswerId,e=a.element(f[0].querySelectorAll(".answer")),g=0;g<e.length;g++){var h=a.element(e[g]);if(h&&h.scope&&h.scope()){var i,l,p=h.scope().answer;j.getViewMode()===m||j.getViewMode()===o?(l="answered",i=c===p.id?"answered":"neutral"):a.isUndefined(c)?j.getViewMode()===n&&(i=d===p.id?"answered-incorrect":"neutral"):i=c===p.id?d===p.id?"correct":"wrong":p.id===d?"answered-incorrect":"neutral",h.removeClass(l),h.addClass(i)}}}var j=h[0],k=h[1],l=c.ANSWER_WITH_RESULT["enum"],m=c.ONLY_ANSWER["enum"],n=c.REVIEW["enum"],o=c.MUST_ANSWER["enum"];e.d={},e.d.answers=j.question.answers,e.d.click=function(a){var b=j.getViewMode();!isNaN(parseInt(k.$viewValue))&&b===l||b===n||(k.$setViewValue(a.id),i(b))},e.d.getIndexChar=function(a){return d.selectAnswer.getAnswerIndex(a,j.question)},k.$render=function(){b(function(){i()})},k.$render(),e.$on("exercise:viewModeChanged",function(){k.$render()})}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").provider("ZnkExerciseAnswersSrv",function(){this.config={selectAnswer:{}};var b={};this.config.selectAnswer.setAnswerIndexFormatter=function(a){b.answerIndexFormatter=a},this.$get=[function(){var c={selectAnswer:{}};return c.selectAnswer.getAnswerIndex=function(c){var d;if(b.answerIndexFormatter&&(d=b.answerIndexFormatter.apply(this,arguments)),a.isUndefined(d)){var e=65;d=String.fromCharCode(e+c)}return d},c}]})}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("freeTextAnswerGrid",[function(){return{templateUrl:"scripts/exercise/templates/freeTextAnswerGridDrv.html",restrict:"E",require:"ngModel",scope:{cellsNumGetter:"&cellsNum"},link:function(b,c,d,e){function f(){e.$setViewValue(a.copy(b.d.cells))}b.buttonArray=[1,2,3,4,5,6,7,8,9];var g=b.cellsNumGetter()||3;b.d={viewCells:new Array(g)},b.onClickNum=function(a){d.disabled||b.d.cells.length>=g||(b.d.cells.push(a),f())},b.onClickErase=function(){!d.disabled&&b.d.cells.length&&(b.d.cells.pop(),f())},e.$render=function(){b.d.cells=a.isDefined(e.$viewValue)?e.$viewValue:[]}}}}])}(angular),function(a){a.module("znk.infra.znkExercise").directive("markup",["$window",function(b){var c=!1,d=275,e=a.element("<P/>");return{replace:!0,restrict:"E",link:function(f,g,h){var i=function(a){return e.append(a),e.contents()},j=function(a){var b={width:"",height:""};if(a.style.width){var c=a.style.height,e=a.style.width;if(c=c.replace("px",""),e=e.replace("px",""),!isNaN(e)){for(e=parseInt(e);e>d;)e=.9*e,c=.9*c;b.width=e+"px",b.height=c+"px"}}return b},k=function(b){for(var c,d=0;d<b.length;d++)if(b[d].tagName&&"img"===b[d].tagName.toLowerCase())b[d].style.width&&(c=j(b[d]),b[d].style.width=c.width,b[d].style.height=c.height);else{var e=a.element(b[d]).find("img");if(e.length)for(var f=0;f<e.length;f++)e[f].style.width&&(c=j(e[f]),e[f].style.width=c.width,e[f].style.height=c.height)}return b},l=function(a){for(var b=0;b<a.length;b++)if(a[b].tagName&&"p"===a[b].tagName.toLowerCase()){if(!a[b].style)break;var c=a[b].style.marginLeft;c=c?c.replace("px",""):c,c&&!isNaN(c)&&(a[b].style.marginLeft=0)}return a},m=f.$watch(h.content,function(a){if(a){d=c?b.innerWidth/1.05:b.innerWidth/1.25;var e=i(a);if(e){var f=k(e);f=l(f),g.append(f)}m()}})}}}])}(angular),function(a){a.module("znk.infra.znkExercise").directive("arrayToStringFmtr",[function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){return a&&a.length?a.join(""):void 0}function f(a){return a&&a.length?a.match(/.{1}/g):[]}d.$parsers.push(e),d.$formatters.push(f)}}}])}(angular),function(a){"use strict";var b={BOOKMARK:"znk exercise:bookmark",QUESTION_ANSWERED:"znk exercise:question answered",READY:"znk exercise: exercise ready",QUESTION_CHANGED:"znk exercise: question changed",QUESTIONS_NUM_CHANGED:"znk exercise: questions num changed"};a.module("znk.infra.znkExercise").constant("ZnkExerciseEvents",b)}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("questionBuilder",["$compile","QuestionTypesSrv","$timeout","ZnkExerciseUtilitySrv",function(a,b,c,d){return{restrict:"E",require:["questionBuilder","^znkExercise"],scope:{questionGetter:"&question"},controller:["$scope",function(a){var b=this;b.question=a.questionGetter()}],link:{pre:function(a,b,c,e){var f=e[0],g=e[1],h=["getViewMode","addQuestionChangeResolver","removeQuestionChangeResolver"];d.bindFunctions(f,g,h)},post:function(d,e,f,g){var h=g[0],i=g[1],j=b.getQuestionHtmlTemplate(h.question);e.append(j);var k=d.$new(!0);a(e.contents())(k);var l;c(function(){l=c(function(){i.notifyQuestionReady(h.question.__questionStatus.index)})},0,!1),d.$on("$destroy",function(){c.cancel(l)})}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("questionsCarousel",["ZnkExerciseSrv","PlatformEnum","$log","ZnkExerciseSlideDirectionEnum",function(a,b,c,d){return{templateUrl:function(){var d="components/znkExercise/core/template/",e=a.getPlatform();switch(e){case b.DESKTOP["enum"]:d+="questionSwiperDesktopTemplate.html";break;case b.MOBILE["enum"]:d+="questionSwiperMobileTemplate.html"}return d||c.error("znkExerciseBtnSectionDrv directive: template was not defined for platform"),d},require:"ngModel",scope:{questionsGetter:"&questions",onQuestionAnswered:"&"},link:function(a,b,c,e){a.vm={},e.$render=function(){a.vm.currSlideIndex=e.$viewValue},a.vm.SlideChanged=function(){e.$setViewValue(a.vm.currSlideIndex)},c.$observe("slideDirection",function(b){var c=+b;if(a.vm.swiperActions&&!isNaN(c))switch(c){case d.NONE["enum"]:a.vm.swiperActions.lockSwipes();break;case d.RIGHT["enum"]:a.vm.swiperActions.unlockSwipeToPrev(),a.vm.swiperActions.lockSwipeToNext();break;case d.LEFT["enum"]:a.vm.swiperActions.lockSwipeToPrev(),a.vm.swiperActions.unlockSwipeToNext();break;default:a.vm.swiperActions.unlockSwipes()}}),a.$watch("questionsGetter().length",function(b){var c=a.questionsGetter();return b&&!a.vm.questions?void(a.vm.questions=c):(a.vm.questions=c,void a.vm.swiperActions.updateFollowingSlideAddition())})}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("znkExerciseBtnSection",["ZnkExerciseSrv","PlatformEnum","$log","ZnkExerciseEvents","ZnkExerciseViewModeEnum",function(a,b,c,d,e){return{restrict:"E",scope:{prevQuestion:"&?",nextQuestion:"&?",onDone:"&",questionsGetter:"&questions"},require:"^znkExercise",templateUrl:function(){var d="components/znkExercise/core/template/",e=a.getPlatform();switch(e){case b.DESKTOP["enum"]:d+="btnSectionDesktopTemplate.html";break;case b.MOBILE["enum"]:d+="btnSectionMobileTemplate.html"}return d||c.error("znkExerciseBtnSectionDrv directive: template was not defined for platform"),d},link:{pre:function(a,b,c,f){function g(b){a.vm.currentQuestionIndex=b||0}function h(b){var c=f.getQuestions();c.then(function(c){a.vm.maxQuestionIndex=c.length-1,b&&b===c.length-1||f.isLastUnansweredQuestion()?a.vm.showDoneButton=!0:a.vm.showDoneButton=!1})}function i(){f.getQuestions().then(function(b){a.vm.maxQuestionIndex=b.length-1}),g(f.getCurrentIndex())}function j(b){var c=37,d=39;switch(b.keyCode){case c:a.vm.prevQuestion();break;case d:a.vm.nextQuestion()}}var k=f.getViewMode();a.vm={},i(),a.vm.prevQuestion=function(){a.prevQuestion()},a.vm.nextQuestion=function(){a.nextQuestion()},a.$on(d.QUESTION_CHANGED,function(a,b){g(b),h(b)}),a.$on(d.QUESTION_ANSWERED,function(){f.isLastUnansweredQuestion()&&(a.vm.showDoneButton=!0)}),a.$on(d.QUESTIONS_NUM_CHANGED,function(){var a=f.getCurrentIndex();h(a)});var l=document.body;l.addEventListener("keydown",j),a.$on("$destroy",function(){l.removeEventListener("keydown",j)});var m;k!==e.REVIEW["enum"]&&(m=function(){return f.isCurrentQuestionAnswered()},a.$watch(m,function(b){a.vm.isCurrentQuestionAnswered=!!b}))}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("znkSwiper",["$timeout","$q",function(b,c){return{templateUrl:"components/znkExercise/core/template/znkSwiperTemplate.html",replace:!0,restrict:"E",require:"ngModel",scope:{},transclude:!0,compile:function(){function d(b,c,d,e){if(d.actions){b.$parent.$eval(d.actions)||b.$parent.$eval(d.actions+"={}");var f=b.$parent.$eval(d.actions),h=["lockSwipes","lockSwipeToPrev","lockSwipeToNext","unlockSwipes","unlockSwipeToPrev","unlockSwipeToNext"];h.forEach(function(a){f[a]=function(){var b=arguments;g.then(function(c){c[a].apply(c,b)})}}),f.updateFollowingSlideAddition=function(){return g.then(function(a){a.updateContainerSize(),a.updateSlidesSize()})}}e.$render=function(){var b=e.$viewValue;a.isNumber(b)&&g.then(function(a){a.slideTo(b)})},g.then(function(a){a.on("onSlideChangeEnd",function(a){e.$setViewValue(a.activeIndex)})}),b.$on("$destroy",function(){g.then(function(a){a.destroy()})})}function e(a,c){b(function(){f.resolve(new Swiper(c[0]))},0,!1)}var f=c.defer(),g=f.promise;return{pre:d,post:e}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").provider("QuestionTypesSrv",function(){var b={};this.setQuestionTypesHtmlTemplate=function(a){b=a};var c=a.noop;this.setQuestionTypeGetter=function(a){c=a},this.$get=["$log",function(a){var d={};return d.getQuestionHtmlTemplate=function(d){var e=c(d);return b[e]||a.error("QuestionTypesSrv: Template was not registered for the following question type:",e),b[e]},d}]})}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("ZnkExerciseSrv",["EnumSrv","$window","PlatformEnum",function(a,b,c){var d={},e=b.ionic?c.MOBILE["enum"]:c.DESKTOP["enum"];return d.getPlatform=function(){return e},d.openExerciseToolBoxModal=function(){},d.toolBoxTools={BLACKBOARD:"blackboard",MARKER:"mar",CALCULATOR:"cal",BOOKMARK:"bookmark",SHOW_PAGER:"show pager"},d}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("znkExercise",["ZnkExerciseSrv","$location","$window","$q","ZnkExerciseEvents","PlatformEnum","$log","ZnkExerciseViewModeEnum","ZnkExerciseSlideDirectionEnum","$timeout","ZnkExerciseUtilitySrv",function(b,c,d,e,f,g,h,i,j,k,l){return{templateUrl:"components/znkExercise/core/template/znkExerciseDrv.html",restrict:"E",transclude:!0,controllerAs:"vm",require:["znkExercise","ngModel"],scope:{questionsGetter:"&questions",settings:"=?",actions:"=?"},controller:"ZnkExerciseDrvCtrl",compile:function(c){var m=b.getPlatform();m||h.$error("znkExercise directive: undefined platform received.");var n=g.getEnumMap();return c.addClass(n[m]),{pre:function(c,g,h,m){function n(a,b){var d=c.vm.slideDirection;switch(d){case j.NONE["enum"]:return e.reject();case j.RIGHT["enum"]:return b>a?!0:e.reject(!1);case j.LEFT["enum"]:return a>b?!0:e.reject(!1);default:return!0}}function o(a){t=a,c.vm.questionsWithAnswers=t,u.setExerciseAsReady()}function p(){v.$setViewValue(a.copy(c.vm.questionsWithAnswers))}function q(){return t[c.vm.currentSlide]}function r(b){if(b=a.isDefined(b)?b:c.vm.currentSlide,c.settings.viewMode!==i.REVIEW["enum"]){if(!r.lastTimeStamp)return void(r.lastTimeStamp=Date.now());var d=Date.now(),e=d-r.lastTimeStamp;r.lastTimeStamp=d;var f=c.vm.questionsWithAnswers[b];f.__questionStatus.timeSpent=(f.__questionStatus.timeSpent||0)+e,p()}}var s={onDone:a.noop,onQuestionAnswered:a.noop,viewMode:i.ANSWER_WITH_RESULT["enum"],onSlideChange:a.noop,initSlideDirection:j.ALL["enum"],initForceDoneBtnDisplay:null,initPagerDisplay:!0};c.settings=a.extend(s,c.settings);var t,u=m[0],v=m[1],w={},x=d.innerWidth<=567;u.addQuestionChangeResolver(n),c.vm.answeredCount=0,u.setCurrentIndex(c.settings.initSlideIndex||0),c.actions=c.actions||{},c.actions.setSlideIndex=function(a){u.setCurrentIndex(a)},c.actions.getCurrentIndex=function(){return u.getCurrentIndex()},c.actions.finishExercise=function(){r()},c.actions.setSlideDirection=function(b){if(a.isDefined(b)){var d=b===j.RIGHT["enum"],e=b===j.LEFT["enum"],f=b===j.ALL["enum"],h="direction",i=h+"-"+j.RIGHT.val;d||f?g.addClass(i):g.removeClass(i);var k=h+"-"+j.LEFT.val;e||f?g.addClass(k):g.removeClass(k),c.vm.slideDirection=b}},c.actions.forceDoneBtnDisplay=function(a){a===!0?g.addClass("done-btn-show"):g.removeClass("done-btn-show"),a===!1?g.addClass("done-btn-hide"):g.removeClass("done-btn-hide")},c.actions.pagerDisplay=function(a){var b=!!a;b?g.addClass("pager-displayed"):g.removeClass("pager-displayed"),c.vm.showPager=!!a},v.$render=function(){o(v.$viewValue)};var y={toolsToHide:c.settings.toolsToHide,wrapperCls:c.settings.toolBoxWrapperClass||""};y.events={onToolOpened:function(a){var d=q();switch(a.tool){case b.toolBoxTools.BLACKBOARD:y.actions.setToolValue(b.toolBoxTools.BLACKBOARD,d.__questionStatus.blackboardData||{}),x&&(c.vm.hidePager=!0)}},onToolClosed:function(a){var d=q();switch(a.tool){case b.toolBoxTools.BLACKBOARD:d.__questionStatus.blackboardData=a.value,x&&(c.vm.hidePager=!1)}p()},onToolValueChanged:function(a){switch(a.tool){case b.toolBoxTools.BOOKMARK:c.vm.bookmarkCurrentQuestion()}p()}};var z=b.openExerciseToolBoxModal(y);w.formatter=function(b){b||(b=[]);var d={};b.forEach(function(b){b&&a.isDefined(b.questionId)&&(d[b.questionId]=b)});var e=c.questionsGetter()||[],f=e.map(function(b,c){var e=a.copy(b),f=d[e.id]||{};e.__questionStatus={index:c};for(var g in f)e.__questionStatus[g]=f[g];return e});return f},v.$formatters.push(w.formatter),w.parser=function(b){c.vm.answeredCount=0;var d=v.$modelValue||[];return b.forEach(function(b,e){if(!a.isUndefined(b.__questionStatus)){var f={questionId:b.id},g=["blackboardData","timeSpent","bookmark","userAnswer","isAnsweredCorrectly","audioEnded"];g.forEach(function(c){var d=b.__questionStatus[c];a.isDefined(d)&&(f[c]=d)}),a.isDefined(f.userAnswer)&&c.vm.answeredCount++,d[e]=f}}),d},v.$parsers.push(w.parser),c.vm.questionAnswered=function(){if(c.settings.viewMode!==i.REVIEW["enum"]){var a=q(),b=a.__questionStatus.userAnswer;a.__questionStatus.isAnsweredCorrectly=l.isAnswerCorrect(a,b),r()}c.$broadcast(f.QUESTION_ANSWERED,q()),k(function(){c.settings.onQuestionAnswered(c.vm.currentSlide)})},c.vm.bookmarkCurrentQuestion=function(){var a=q();a.__questionStatus.bookmark=!a.__questionStatus.bookmark,c.$broadcast(f.BOOKMARK,a),p()},c.actions.setSlideDirection(c.settings.initSlideDirection),null===c.settings.initForceDoneBtnDisplay&&c.settings.viewMode===i.REVIEW["enum"]?c.actions.forceDoneBtnDisplay(!1):c.actions.forceDoneBtnDisplay(c.settings.initForceDoneBtnDisplay),c.actions.pagerDisplay(c.settings.initPagerDisplay),c.$watch("vm.currentSlide",function(d,e){if(!a.isUndefined(d)){var g=q();r(e),y.actions&&y.actions.setToolValue&&y.actions.setToolValue(b.toolBoxTools.BOOKMARK,!!g.__questionStatus.bookmark),k(function(){c.settings.onSlideChange(g,d),c.$broadcast(f.QUESTION_CHANGED,d,e,g)},0,!1)}}),c.$watch("vm.questionsWithAnswers.length",function(a,b){c.$broadcast(f.QUESTIONS_NUM_CHANGED,a,b)}),c.$on("$destroy",function(){z&&z.close()})}}}}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").controller("ZnkExerciseDrvCtrl",["$scope","$q","ZnkExerciseEvents","$log",function(b,c,d,e){function f(c){var d=b.vm.questionsWithAnswers?b.vm.questionsWithAnswers[c]:{};return d&&d.__questionStatus&&a.isDefined(d.__questionStatus.userAnswer)}function g(b,d){var e=[];return k.forEach(function(f){var g=c.when(a.isFunction(f)?f(b,d):f);e.push(g)}),c.all(e)}var h=this,i=c.defer(),j=!1;h.setExerciseAsReady=function(){j||(j=!0,i.resolve(j))},h.isExerciseReady=function(){return j},h.getViewMode=function(){return b.settings.viewMode},h.getSlideDirection=function(){return b.settings.slideDirection};var k=[];h.addQuestionChangeResolver=function(a){k.push(a)},h.removeQuestionChangeResolver=function(a){var b=[];k.forEach(function(c){c!==a&&b.push(c)}),k=b},h.getCurrentIndex=function(){return b.vm.currentSlide},h.setCurrentIndex=function(d){if(a.isDefined(d)){var f=h.getCurrentIndex();return g(d,f).then(function(){d=Math.max(0,d);var a=b.questionsGetter()||[];return d=Math.min(d,a.length-1),b.vm.currentSlide=d,b.vm.currentSlide})}return e.debug("ZnkExerciseDrv: setCurrentIndex was invoked with undefined newQuestionIndex parameter"),c.when(b.vm.currentSlide)},h.setCurrentIndexByOffset=function(a){var b=this.getCurrentIndex(),c=b+a;return this.setCurrentIndex(c)},h.notifyQuestionReady=function(){h.__exerciseReady||(h.__exerciseReady=!0,b.$broadcast(d.READY),i.resolve(!0),b.settings.onExerciseReady&&b.settings.onExerciseReady())},h.isCurrentQuestionAnswered=function(){return f(b.vm.currentSlide)},h.isLastUnansweredQuestion=function(){for(var a=(b.vm.questionsWithAnswers||[]).length,c=0,d=0;a>d;d++)if(!f(d)&&(c++,2===c))return!1;return 1===c},h.getQuestions=function(){return i.promise.then(function(){return b.vm.questionsWithAnswers})}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("znkExercisePager",["$timeout","ZnkExerciseEvents","ZnkExerciseViewModeEnum",function(b,c,d){return{templateUrl:"components/znkExercise/core/template/znkExercisePagerDrv.html",restrict:"E",require:["ngModel","^znkExercise"],scope:{},link:{pre:function(e,f,g,h){function i(b,c){var d=a.element(o.querySelectorAll(".pager-item")[b]);c?d.addClass("bookmark"):d.removeClass("bookmark")}function j(b,c){var e=a.element(o.querySelectorAll(".pager-item")[b]);return a.isUndefined(c.__questionStatus.userAnswer)?void e.removeClass("neutral correct wrong"):n===d.ONLY_ANSWER["enum"]?void e.addClass("neutral"):void(c.__questionStatus.isAnsweredCorrectly?e.addClass("correct"):e.addClass("wrong"))}function k(){p=!0,b(function(){l.$render=function(){var c=+l.$viewValue;isNaN(c)||b(function(){var b,d=a.element(o.querySelectorAll(".pager-item.current"));for(b in d)d.eq(b).removeClass("current");var f=o.querySelectorAll(".pager-item"),g=a.element(f[c]);g.addClass("current");for(b in e.questions){var h=e.questions[b];i(b,h.__questionStatus.bookmark),j(b,h)}})},l.$render()},!1)}var l=h[0],m=h[1],n=m.getViewMode(),o=f[0];e.d={},e.d.tap=function(a){m.setCurrentIndex(a)},e.$on(c.BOOKMARK,function(a,b){i(b.__questionStatus.index,b.__questionStatus.bookmark)}),e.$on(c.QUESTION_ANSWERED,function(a,b){j(b.__questionStatus.index,b)});var p;e.$parent.$watch(g.questions,function(a){a&&(e.questions=a,p||k())})}}}}])}(angular),function(){angular.module("znk.infra.znkExercise").directive("blackboardDrv",["GoBackHardwareSrv",function(a){return{restric:"EA",scope:{drawingData:"=",actions:"&",close:"&"},replace:!0,templateUrl:"scripts/exercise/templates/blackboardDrv.html",link:function(b,c){function d(){b.close()}function e(){b.d.activeDrawMode=o.pen}function f(){b.d.activeDrawMode=o.eraser}function g(){s.clearRect(0,0,r.width,r.height),b.drawingData.dataUrl=null}function h(a){return a.toDataURL()}function i(a,b){var c=new Image;c.onload=function(){b.width=c.width,b.height=c.height,b.getContext("2d").drawImage(c,0,0)},c.src=a}function j(a){a.preventDefault(),a.stopPropagation(),p=a.targetTouches[0].pageX,q=a.targetTouches[0].pageY,m(p+1,q+1)}function k(a){a.preventDefault(),a.stopPropagation();var b=a.targetTouches[0].pageX,c=a.targetTouches[0].pageY;m(b,c),p=b,q=c}function l(a){a.preventDefault(),a.stopPropagation(),b.drawingData=b.drawingData||{},b.drawingData.dataUrl=h(r)}function m(a,c){s.beginPath(),b.d.activeDrawMode===o.pen?(s.globalCompositeOperation="source-over",s.strokeStyle="#FFFFFF",s.lineWidth=4,s.moveTo(p,q),s.lineTo(a,c),s.stroke()):b.d.activeDrawMode===o.eraser&&(s.globalCompositeOperation="destination-out",s.arc(p,q,16,0,2*Math.PI,!1),s.fill())}a.registerHandler(d,void 0,!0);var n=b.actions()||{};angular.extend(n,{activatePen:e,activateEraser:f,clear:g});var o={pen:1,eraser:2};b.d={drawModes:o,activeDrawMode:o.pen};var p,q,r=c.find("canvas")[0];r.width=c[0].offsetWidth,r.height=c[0].offsetHeight;var s=r.getContext("2d");b.drawingData.dataUrl&&i(b.drawingData.dataUrl,r),r.addEventListener("touchstart",j),r.addEventListener("touchmove",k),r.addEventListener("touchend",l),b.$on("$destroy",function(){r.removeEventListener("touchstart",j),r.removeEventListener("touchmove",k),r.removeEventListener("touchend",l)})}}}])}(),function(a){a.module("znk.infra.znkExercise").directive("calculator",["GoBackHardwareSrv",function(a){var b=math.cos,c=math.sin,d=math.tan;return{scope:{calcTop:"=",close:"&"},link:function(e){function f(){e.close()}a.registerHandler(f,void 0,!0),math.cos=function(a){return b(math.unit(a,e.trigunits))},math.sin=function(a){return c(math.unit(a,e.trigunits))},math.tan=function(a){return d(math.unit(a,e.trigunits))},e.onClickAns=function(){"ERR"!==e.result&&(e.expression=e.result)},e.onClickNum=function(a){e.expression+=String(a)},e.onClickAdd=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" + "},e.onClickSubtract=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" - "},e.onClickMultiply=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" * "},e.onClickDivide=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" / "},e.onClickClear=function(){e.expression="",e.result=0},e.onClickDot=function(){e.expression+="."},e.onClickPi=function(){e.expression+=" pi "},e.onClickE=function(){e.expression+=" e "},e.onClickRad=function(){e.trigunits="rad"},e.onClickDeg=function(){e.trigunits="deg"},e.onClickSin=function(){e.expression+=" sin(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickCos=function(){e.expression+=" cos(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickTan=function(){e.expression+=" tan(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickSqr=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" ^2 "},e.onClickPowThree=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" ^3 "},e.onClickPow=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+=" ^ "},e.onClickSqrt=function(){e.expression+=" sqrt(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickInv=function(){e.expression+=" inv(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickAbs=function(){e.expression+=" abs(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickFact=function(){e.result&&"ERR"!==e.result&&(e.expression+=e.result),e.expression+="! "},e.onClickLog=function(){e.expression+=" log(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickLn=function(){e.expression+=" ln(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickOpenParen=function(){e.expression+="(",e.result&&"ERR"!==e.result&&(e.expression+=e.result)},e.onClickCloseParen=function(){e.expression+=")"},e.onClickUndo=function(){e.expression=e.expression.trimRight(),e.expression=e.expression.substring(0,e.expression.length-1)},e.onClickEqual=function(){var a=e.expression.replace("log","log10").replace("ln","log");try{e.result=math.round(math.eval(a),5)}catch(b){try{a+=")",e.result=math.round(math.eval(a),5)}catch(b){e.result="ERR"}}e.expression=""},e.onClickMPlus=function(){e.mem+=e.result},e.onClickMc=function(){e.mem=0},e.onClickMR=function(){e.expression+=e.mem},e.hasMemory=function(){return e.mem>0};var g=function(){e.result=0,e.expression="",e.mem=0,e.trigunits="rad"};g()},templateUrl:"scripts/exercise/templates/calculator.html"}}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").controller("ZnkExerciseToolBoxModalCtrl",["$scope","ZnkExerciseDrvSrv","Settings",function(b,c,d){function e(a,b){var c={tool:a,value:b};d.events.onToolValueChanged&&d.events.onToolValueChanged(c)}d.actions=d.actions||{},d.events=d.events||{},d.events.onToolOpened=d.events.onToolOpened||a.noop,d.events.onToolOpened=d.events.onToolOpened||a.noop,b.d={blackboardTool:{actions:{},value:{}},bookmarkTool:{},showPagerTool:{},tools:c.toolBoxTools,toolsStatus:{},toolsToHide:d.toolsToHide},d.actions.setToolValue=function(a,c){switch(a){case b.d.tools.BOOKMARK:b.d.bookmarkTool.value=c;break;case b.d.tools.BLACKBOARD:b.d.blackboardTool.value=c}},b.d.openTool=function(a){var c={tool:a};d.events.onToolOpened(c),b.d.toolsStatus[a]=!0},b.d.closeTool=function(a){var c={tool:a};switch(a){case b.d.tools.BLACKBOARD:c.value=b.d.blackboardTool.value;break;case b.d.tools.BOOKMARK:c.value=b.d.bookmarkTool.value}d.events.onToolClosed(c),b.d.toolsStatus[a]=!1},b.d.reverseBookmarkValue=function(){b.d.bookmarkTool.value=!b.d.bookmarkTool.value,e(b.d.tools.BOOKMARK,b.d.bookmarkTool.value)},b.d.activateBlackboardPencil=function(){b.d[b.d.tools.BLACKBOARD]||b.d.openTool(b.d.tools.BLACKBOARD),b.d.blackboardTool.pencilActivated=!0,b.d.blackboardTool.actions.activatePen&&b.d.blackboardTool.actions.activatePen()},b.d.activateBlackboardEraser=function(){b.d.blackboardTool.pencilActivated=!1,b.d.blackboardTool.actions.activateEraser&&b.d.blackboardTool.actions.activateEraser()},b.d.reverseShowPagerValue=function(){b.d.showPagerTool.value=!b.d.showPagerTool.value,e(b.d.tools.SHOW_PAGER,b.d.showPagerTool.value)},b.d.onCalcClick=function(){b.d.toolsStatus.hasOwnProperty(b.d.tools.CALCULATOR)?b.d.closeTool(b.d.tools.CALCULATOR):b.d.openTool(b.d.tools.CALCULATOR);
}}])}(angular),function(a){"use strict";var b={};b.tutorial={FINISH:"tutorial:finish"},b.drill={FINISH:"drill:finish"},b.practice={FINISH:"practice:finish"},b.game={FINISH:"game:finish"},b.section={FINISH:"section:finish"},b.daily={STATUS_CHANGED:"daily:status"},b.exam={COMPLETE:"exam:complete"},a.module("znk.infra.znkExercise").constant("exerciseEventsConst",b)}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").directive("templateByPlatform",["ZnkExerciseSrv","PlatformEnum","$log",function(a,b,c){return{templateUrl:function(d,e){var f,g=e.prefix||"",h=a.getPlatform();switch(h){case b.DESKTOP["enum"]:f=e.desktopTemp;break;case b.MOBILE["enum"]:f=e.mobileTemp}return f||c.error("templateByPlatform directive: template was not defined for platform"),g+"/"+f},restrict:"E"}}])}(angular),function(a){"use strict";var b={unanswered:0,correct:1,wrong:2};a.module("znk.infra.znkExercise").constant("exerciseAnswerStatusConst",b),a.module("znk.infra.znkExercise").factory("ExerciseAnswerStatusEnum",["EnumSrv",function(a){var c=new a.BaseEnum([["unanswered",b.unanswered,"unanswered"],["correct",b.correct,"correct"],["wrong",b.wrong,"wrong"]]);return c.convertSimpleAnswerToAnswerStatusEnum=function(a){switch(a){case!0:return c.correct["enum"];case!1:return c.wrong["enum"];default:return c.unanswered["enum"]}},c}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("PlatformEnum",["EnumSrv",function(a){return new a.BaseEnum([["MOBILE",1,"mobile"],["DESKTOP",2,"desktop"]])}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("ZnkExerciseSlideDirectionEnum",["EnumSrv",function(a){return new a.BaseEnum([["NONE",1,"none"],["ALL",2,"all"],["RIGHT",3,"right"],["LEFT",4,"left"]])}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("ZnkExerciseViewModeEnum",["EnumSrv",function(a){return new a.BaseEnum([["ANSWER_WITH_RESULT",1,"answer with result"],["ONLY_ANSWER",2,"answer only"],["REVIEW",3,"review"],["MUST_ANSWER",4,"must answer"]])}])}(angular),function(a){"use strict";a.module("znk.infra.znkExercise").factory("ZnkExerciseUtilitySrv",["AnswerTypeEnum","$log",function(b,c){var d={};d.bindFunctions=function(a,b,c){c.forEach(function(c){a[c]=b[c].bind(b)})};var e;return d.isAnswerCorrect=function(a,c){var d,f;switch(a.answerTypeId){case b.SELECT_ANSWER["enum"]:f=""+c,d=""+a.correctAnswerId===f;break;case b.FREE_TEXT_ANSWER["enum"]:f=""+c,e=a.correctAnswerText.map(function(a){return""+a.content}),d=-1!==e.indexOf(f);break;case b.RATE_ANSWER["enum"]:f=""+c,e=a.correctAnswerText.map(function(a){return""+a.id}),d=-1!==e.indexOf(f)}return!!d},d.setQuestionsGroupData=function(b,d){var e={};a.forEach(d,function(a){e[a.id]=a}),a.forEach(b,function(a){e[a.groupDataId]||c.debug("Group data is missing for the following question id "+a.id),a.groupData=e[a.groupDataId]||{}})},d}])}(angular),angular.module("znk.infra").run(["$templateCache",function(a){a.put("components/general/templates/timerDrv.html",'<div ng-switch="type" class="timer-drv">\n    <div ng-switch-when="1" class="timer-type1">\n        <svg-icon class="icon-wrapper" name="clock-icon"></svg-icon>\n        <div class="timer-view"></div>\n    </div>\n    <div ng-switch-when="2" class="timer-type2">\n        <div class="timer-display-wrapper">\n            <span class="timer-display"></span>\n        </div>\n        <div round-progress\n             current="ngModelCtrl.$viewValue"\n             max="config.max"\n             color="{{config.color}}"\n             bgcolor="{{config.bgcolor}}"\n             stroke="{{config.stroke}}"\n             radius="{{config.radius}}"\n             clockwise="config.clockwise">\n        </div>\n    </div>\n</div>\n'),a.put("components/znkExercise/answerTypes/templates/rateAnswerDrv.html",'<div class="rate-answer-wrapper">\n\n    <div class="checkbox-items-wrapper" >\n\n        <div class="item-repeater" ng-repeat="item in ::d.itemsArray track by $index">\n            <svg-icon class="correct-icon" name="correct"></svg-icon>\n            <svg-icon class="wrong-icon" name="wrong"></svg-icon>\n            <div class="checkbox-item" ng-click="clickHandler($index)">\n                <div class="item-index">{{ ::($index + 2)}}</div>\n            </div>\n            <div class="correct-answer-line"></div>\n        </div>\n\n    </div>\n</div>\n'),a.put("components/znkExercise/answerTypes/templates/selectAnswerDrv.html",'<div ng-repeat="answer in ::d.answers track by answer.id" class="answer" ng-click="d.click(answer)">\n    <div class="content-wrapper">\n        <div class="answer-index-wrapper">\n            <span class="index-char">{{::d.getIndexChar($index)}}</span>\n        </div>\n        <markup content="answer.content" type="md" class="content"></markup>\n        <svg-icon class="correct-icon-drv" name="correct"></svg-icon>\n        <svg-icon class="wrong-icon-drv" name="wrong"></svg-icon>\n    </div>\n</div>\n'),a.put("components/znkExercise/core/template/btnSectionDesktopTemplate.html",'<div class="btn-container left-container ng-hide" ng-show="!!vm.currentQuestionIndex">\n    <button ng-click="vm.prevQuestion()">\n        <svg-icon name="chevron"></svg-icon>\n    </button>\n</div>\n<div class="btn-container right-container ng-hide"\n     ng-show="vm.maxQuestionIndex !== vm.currentQuestionIndex"\n     ng-class="{\'question-answered\': vm.isCurrentQuestionAnswered}">\n    <button ng-click="vm.nextQuestion()">\n        <svg-icon name="chevron"></svg-icon>\n    </button>\n</div>\n<div class="done-btn-wrap">\n    <button class="done-btn ng-hide"\n            ng-show="vm.showDoneButton"\n            ng-click="onDone()">DONE\n    </button>\n</div>\n'),a.put("components/znkExercise/core/template/btnSectionMobileTemplate.html",'<div ng-class="{ \'next-disabled\' : settings.slideDirection === d.slideDirections.NONE ||  settings.slideDirection === d.slideDirections.RIGHT }">\n    <div class="bookmark-icon-container only-tablet"\n         ng-class="vm.questionsWithAnswers[vm.currentSlide].__questionStatus.bookmark ? \'bookmark-active-icon\' : \'bookmark-icon\'"\n         ng-click="vm.bookmarkCurrentQuestion()"\n         ng-hide="settings.viewMode === d.reviewModeId"\n         analytics-on="click"\n         analytics-event="click-bookmark-question"\n         analytics-category="exercise"></div>\n    <ng-switch\n            on="vm.currentSlide !== vm.questionsWithAnswers.length - 1 && vm.answeredCount !== vm.questionsWithAnswers.length"\n            ng-hide="settings.viewMode === d.reviewModeId"\n            class="ng-hide"\n            ng-click="d.next()">\n        <button ng-switch-when="true"\n                class="btn next">\n            <div class="only-tablet"\n                 analytics-on="click"\n                 analytics-event="click-next"\n                 analytics-category="exercise">\n                <span>NEXT</span>\n                <i class="question-arrow-right-icon"></i>\n            </div>\n        </button>\n        <button ng-switch-when="false"\n                class="btn finish">\n            <div analytics-on="click"\n                 analytics-event="click-finish"\n                 analytics-category="exercise">DONE\n            </div>\n        </button>\n    </ng-switch>\n    <button class="btn sum ng-hide"\n            ng-click="settings.onSummary()"\n            ng-show="settings.viewMode === d.reviewModeId"\n            analytics-on="click"\n            analytics-event="click-summary"\n            analytics-category="exercise">SUMMARY\n    </button>\n</div>\n'),a.put("components/znkExercise/core/template/questionSwiperDesktopTemplate.html",'<znk-swiper class="znk-carousel"\n            ng-model="vm.currSlideIndex"\n            actions="vm.swiperActions"\n            ng-change="vm.SlideChanged()"\n            disable-swipe="{{vm.isLocked}}">\n    <div class="swiper-slide"\n        ng-repeat="question in vm.questions">\n        <question-builder question="question"\n                          ng-model="question.__questionStatus.userAnswer"\n                          ng-change="onQuestionAnswered(question)">\n        </question-builder>\n    </div>\n</znk-swiper>\n'),a.put("components/znkExercise/core/template/questionSwiperMobileTemplate.html",'<ion-slide-box znk-slide="settings.slideDirection" class="znk-carousel"\n               show-pager="false"\n               active-slide="vm.currentSlide">\n    <question-builder slide-repeat-drv="question in vm.questionsWithAnswers"\n                      question="question"\n                      ng-model="question.__questionStatus.userAnswer"\n                      ng-change="vm.questionAnswered(question)">\n    </question-builder>\n</ion-slide-box>\n'),a.put("components/znkExercise/core/template/znkExerciseDrv.html",'<div ng-transclude></div>\n<questions-carousel class="znk-carousel-container"\n                    questions="vm.questionsWithAnswers"\n                    disable-swipe="{{vm.slideDirection !== 2}}"\n                    ng-model="vm.currentSlide"\n                    on-question-answered="vm.questionAnswered()"\n                    slide-direction="{{vm.slideDirection}}">\n</questions-carousel>\n<znk-exercise-btn-section class="btn-section"\n                          prev-question="vm.setCurrentIndexByOffset(-1)"\n                          next-question="vm.setCurrentIndexByOffset(1)"\n                          on-done="settings.onDone()">\n</znk-exercise-btn-section>\n<znk-exercise-pager class="ng-hide"\n                    ng-show="vm.showPager"\n                    questions="vm.questionsWithAnswers"\n                    ng-model="vm.currentSlide">\n</znk-exercise-pager>\n'),a.put("components/znkExercise/core/template/znkExercisePagerDrv.html",'<znk-scroll>\n    <div class="pager-items-wrapper">\n        <div class="pager-item"\n             ng-repeat="question in questions track by question.id"\n             question-status="question.__questionStatus"\n             question="question"\n             ng-click="d.tap($index)">\n            <div class="question-bookmark-icon"></div>\n            <div class="question-status-indicator">\n                <div class="index">{{::$index + 1}}</div>\n            </div>\n        </div>\n    </div>\n</znk-scroll>\n'),a.put("components/znkExercise/core/template/znkSwiperTemplate.html",'<div class="swiper-container">\n    <!-- Additional required wrapper -->\n    <div class="swiper-wrapper" ng-transclude>\n        <!-- Slides -->\n    </div>\n</div>\n'),a.put("components/general/svg/clock-icon.svg",'<svg version="1.1" class="clock-icon-svg"\n     xmlns="http://www.w3.org/2000/svg"\n     x="0px"\n     y="0px"\n     viewBox="0 0 183 208.5">\n    <style>\n        .clock-icon-svg .st0 {\n            fill: none;\n            stroke: #757A83;\n            stroke-width: 10.5417;\n            stroke-miterlimit: 10;\n        }\n\n        .clock-icon-svg .st1 {\n            fill: none;\n            stroke: #757A83;\n            stroke-width: 12.3467;\n            stroke-linecap: round;\n            stroke-miterlimit: 10;\n        }\n\n        .clock-icon-svg .st2 {\n            fill: none;\n            stroke: #757A83;\n            stroke-width: 11.8313;\n            stroke-linecap: round;\n            stroke-miterlimit: 10;\n        }\n\n        .clock-icon-svg .st3 {\n            fill: none;\n            stroke: #757A83;\n            stroke-width: 22.9416;\n            stroke-miterlimit: 10;\n        }\n\n        .clock-icon-svg .st4 {\n            fill: none;\n            stroke: #757A83;\n            stroke-width: 14;\n            stroke-linecap: round;\n            stroke-miterlimit: 10;\n        }\n\n        .clock-icon-svg .st5 {\n            fill: none;\n            stroke: #757A83;\n            stroke-width: 18;\n            stroke-linejoin: round;\n            stroke-miterlimit: 10;\n        }\n\n\n    </style>\n    <g>\n        <circle class="st0" cx="91.5" cy="117" r="86.2"/>\n        <line class="st1" x1="92.1" y1="121.5" x2="92.1" y2="61"/>\n        <line class="st2" x1="92.1" y1="121.5" x2="131.4" y2="121.5"/>\n        <line class="st3" x1="78.2" y1="18.2" x2="104.9" y2="18.2"/>\n        <line class="st4" x1="61.4" y1="7" x2="121.7" y2="7"/>\n        <line class="st5" x1="156.1" y1="43" x2="171.3" y2="61"/>\n    </g>\n</svg>\n'),a.put("components/popUp/svg/exclamation-mark-icon.svg",'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n	 viewBox="-556.8 363.3 50.8 197.2" style="enable-background:new -556.8 363.3 50.8 197.2;" xml:space="preserve">\n<style type="text/css">\n	.exclamation-mark-icon .st0 {\n        fill: none;\n        enable-background: new;\n    }\n</style>\n<g>\n	<path d="M-505.9,401.6c-0.4,19.5-5.2,38.2-8.7,57.1c-2.8,15.5-4.7,31.2-6.7,46.8c-0.3,2.6-1.1,4-3.7,4.3c-1.5,0.2-2.9,0.6-4.4,0.7\n		c-9.2,0.7-9.6,0.4-10.7-8.7c-3.4-29.6-8-58.9-14.6-87.9c-2.3-10.1-3.2-20.4-0.5-30.7c3.7-14.1,17.2-22.3,31.5-19.3\n		c9.2,1.9,14.7,8.8,16.2,20.9C-506.7,390.3-506.4,396-505.9,401.6z"/>\n	<path d="M-528.9,525.7c10.9,0,16.8,5.3,16.9,15.2c0.1,11-9.3,19.7-21.4,19.6c-8.8,0-14.7-7-14.7-17.7\n		C-548.2,530.9-542.4,525.7-528.9,525.7z"/>\n</g>\n</svg>\n'),a.put("components/znkExercise/svg/chevron-icon.svg",'<svg x="0px" y="0px" viewBox="0 0 143.5 65.5">\n    <polyline class="st0" points="6,6 71.7,59.5 137.5,6 "/>\n</svg>\n'),a.put("components/znkExercise/svg/correct-icon.svg",'<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n	 viewBox="0 0 188.5 129" style="enable-background:new 0 0 188.5 129;" xml:space="preserve">\n<style type="text/css">\n	.st0{fill:none;stroke:#231F20;stroke-width:15;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}\n</style>\n<g>\n	<line class="st0" x1="7.5" y1="62" x2="67" y2="121.5"/>\n	<line class="st0" x1="67" y1="121.5" x2="181" y2="7.5"/>\n</g>\n</svg>\n'),a.put("components/znkExercise/svg/wrong-icon.svg",'<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n	 viewBox="0 0 126.5 126.5" style="enable-background:new 0 0 126.5 126.5;" xml:space="preserve">\n<style type="text/css">\n	.st0{fill:none;stroke:#231F20;stroke-width:15;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}\n</style>\n<g>\n	<line class="st0" x1="119" y1="7.5" x2="7.5" y2="119"/>\n	<line class="st0" x1="7.5" y1="7.5" x2="119" y2="119"/>\n</g>\n</svg>\n')}]);